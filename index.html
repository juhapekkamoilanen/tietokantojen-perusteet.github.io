<!DOCTYPE html>
<html>
    <head>
        <title>Tietokantojen perusteet</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <link rel="stylesheet" href="js/libs/syntaxhighlight/css/sh_style.css"/>
	<link rel="stylesheet" href="css/tikape.css"/>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css"/>
    </head>
    <body ng-app='myApp'>

        <!-- BEGIN NAV -->
        <header role="navigation">
            <h1>
                <button type="button" data-toggle="collapse" data-target=".bs-navbar-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>

                <a href="http://www.cs.helsinki.fi"><img src="img/header_tktl.png" alt="CS Dept. Univ. Helsinki"></a>
            </h1>
            <nav class="collapse bs-navbar-collapse" role="navigation">
                <ul>
                    <li>
                        <a href="#viikko1">Viikko 1</a>
                    </li>
                    <li>
                        <a href="#viikko2">Viikko 2</a>
                    </li>
<!--
                    <li>
                        <a href="#viikko3">Viikko 3</a>
                    </li>
                    <li>
                        <a href="#viikko4">Viikko 4</a>
                    </li>
                    <li>
                        <a href="#viikko5">Viikko 5</a>
                    </li>
                    <li>
                        <a href="#viikko6">Viikko 6</a>
                    </li>
                    <li>
                        <a href="#viikko7">Viikko 7</a>
                    </li>
-->
                </ul>
            </nav>
        </header>
        <!-- // END NAV -->
        <article>

            <!-- BEGIN INDEX -->
            <section id="intro" class="no-toc weeklimit" data-week-id="0">
                
                <header>

                    <div class="intro-header-img"></div>

                    <h1>Tietokantojen perusteet</h1>

                    <p><em>"miten tietoa sekä siihen liittyviä yhteyksiä mallinnetaan ja hallinnoidaan?" </em></p>

<!--
                    <a class="call-to-action" href="#start" role="button">No todellakin!</a>
-->
                </header>

                <h1 id="start">Sisältö, aikataulu, arvostelu</h1>

                <p><em>"Kurssilla tutustutaan tiedon esitysmuotoihin ja tiedon hakuun suurista tietomääristä. Erityisenä painopisteenä ovat relaatiotietokannat, joiden kohdalla perehdytään toisaalta teoreettiseen perustaan ja toisaalta tietokannan käytännön käsittelyyn SQL-kielen avulla. Kurssilla opitaan myös perustiedot relaatiotietokantojen suunnittelusta."</em></p>

                <p>Kurssi sisältää seitsemän tehtäväsarjaa, joista ensimmäinen julkaistaan heti kurssin alussa. Tehtävät tulee tehdä ennen viikoittaisia harjoitustilaisuuksia, joissa hyödynnetään tehtävien tekemisessä kertynyttä paikan päällä pohdittavissa suunnittelu- ja toteutustehtävissä.</p>

                <p>Kurssin arvostelu perustuu kurssikokeeseen, harjoitustehtäviin, sekä läsnäoloon harjoitustilaisuuksissa:</p>

                <ul>
                  <li>Kurssikokeessa on kolme tehtävää, joista jokainen on kuuden pisteen arvoinen. Kokeesta voi saada yhteensä 18 pistettä. Käytössä on myös koeleikkuri, eli kurssin hyväksytty suoritus vaatii vähintään puolia koepisteistä.</li>
		  <li>Tekemällä kaikki ennalta tehtävät harjoitustehtävät, jotka alkavat kurssin toiselta viikolta, saa kolme pistettä. Harjoitustehtävistä voi saada yhteensä 18 pistettä.</li>
		  <li>Harjoitustilaisuuksissa läsnäolosta saa kaksi pistettä. Läsnäoloista voi saada yhteensä 14 pistettä.</li>
		</ul>

		<p>Koko kurssista voi saada 50 pistettä. Alustavat arvosanarajat ovat seuraavat:</p>

		<ul>
		  <li>30p -> 1</li>
		  <li>34p -> 2</li>
		  <li>38p -> 3</li>
		  <li>42p -> 4</li>
		  <li>46p -> 5</li>
		</ul>

                <p><a class="jump" href="#viikoittaiset-teemat" role="button">Viikoittaiset teemat &raquo;</a></p>


		<h2>Lisämateriaali</h2>

		<p>Tämän materiaalin lisäksi täydentävänä materiaalina voi käyttää Harri Laineen Tietokantojen perusteet -kurssin oppimateriaalia (<a href="http://www.cs.helsinki.fi/u/laine/tikape/k00/osa1.pdf" target="_blank">osa 1</a>, <a href="http://www.cs.helsinki.fi/u/laine/tikape/k00/osa2.pdf" target="_blank">osa 2</a> ja <a href="http://www.cs.helsinki.fi/u/laine/tikape/k00/osa3.pdf" target="_blank">osa 3</a>), sekä kirjoja "Fundamentals of database systems" (Elmasri &amp; Navathe) ja "Database management systems" (Ramakrishnan &amp; Gehrke). Molemmat löytyvät opiskelijakirjastosta.</p>

                <h2>Esitietovaatimukset</h2>

                <p>Kurssilla ei ole virallisia esitietovaatimuksia. Jos kurssia suorittaa ilman kurssin Ohjelmoinnin perusteet käymistä, on kurssin kuitenkin todennäköisesti työläs. Myös kursseista Ohjelmoinnin jatkokurssi ja Ohjelmistotekniikan menetelmät on kurssilla hyötyä.</p>



                <h2>Muiden auttaminen ja kunniasääntö</h2>

                <p>Vaikka helpoin vastaus avunpyyntöön on usein valmiiden ratkaisujen jakaminen, on se sekä toisen että oman oppimisen kannalta erittäin huono lähestymistapa. Opit parhaiten tutkimalla apua kysyvän ongelmaa ja tarjoamalla sellaista tukea, minkä avulla toinen ymmärtää ongelman ja pystyy etenemään. <strong>Osallistumalla kurssille sitoudut siihen, että et vie oppimisen iloa muilta esimerkiksi laittamalla tehtävien mallivastauksia verkkoon tai jakamalla niitä muille.</strong> Autat muita kurssilaisia parhaiten tekemällä tehtäviä yhdessä muiden kanssa, tarjoamalla apua harjoitustilaisuuksissa sekä osallistumalla teemaan liittyviin keskusteluihin vaikkapa kurssin IRC-kanavalla.</p>

                <div class="two-column">
                    <div class="column">

                        <h1>Luennot ja harjoitustilaisuudet</h1>

                        <p>Kurssin aloitusluento pidetään tiistaina 1.9. kello 12-14 Exactumin salissa CK112.</p>

			<p>Aloitusluennon lisäksi kurssilla on viikoittaiset harjoitusryhmät, jotka järjestetään salissa B221 seuraavina aikoina.</p>

			<ul>
			  <li>Ke 9-12 -- B221, Arto Vihavainen</li>
			  <li>To 9-12 -- B221, Petri Myllys</li>
			  <li>To 14-17 -- B221, Matti Luukkainen</li>
			  <li>Pe 9-12 -- B221, Petri Myllys</li>
			</ul>

			<p>Harjoitusryhmiin ilmoittautuminen tapahtuu kurssi-ilmoittautumisen yhteydessä <a href="https://ilmo.cs.helsinki.fi/ilmo/Ilmo" target="_blank">tietojenkäsittelytieteen laitoksen ilmoittautumisjärjestelmän kautta.</a></p>

			<p>Huom! Harjoitukset alkavat heti kurssin ensimmäisellä viikolla.</p>

                    </div>

                    <div class="column">

                        <h1 id="irc-ohjeet">IRC-ohjeet</h1>

                        <p>Kurssilla on käytössä IRC-kanava #tikape -- ohjeita IRC:n käyttöön löytyy muunmuassa <a href="http://fuksiwiki.tko-aly.fi/IRC-ohjeet" target="_blank">Fuksiwikistä</a> sekä <a href="http://mooc.cs.helsinki.fi/content/irc-ohjeet" target="_blank">mooc.fi:stä</a>.</p>

                    </div>
                </div>


                <h1 id="viikoittaiset-teemat">Alustavat teemat</h1>


		<div id="week-toc" class="nav">
		  <table class="table table-striped">
		    <thead>
		      <tr>
			<th>Viikko</th>
			<th>Yleinen</th>
			<th>Suunnittelu</th>
			<th>SQL</th>
		      </tr>
		    </thead>
		    <tbody>
		      <tr>
			<td>1</td>
			<td>Johdanto, jäsennelty ja jäsentelemätön tieto, tiedon yhdistäminen</td>
			<td>Yhden taulun käsittely, yhdestä moneen yhteydet</td>
			<td>Relaatiot, tiedon hakeminen yhdestä taulusta</td>
		      </tr>
		      <tr>
			<td>2</td>
			<td>Käsitekaaviosta tauluiksi</td>
			<td>Monesta moneen yhteydet</td>
			<td>Tiedon hakeminen, tiedon yhdistäminen useammasta taulusta</td>
		      </tr>
		      <tr>
			<td>3</td>
			<td></td>
			<td>Käsitekaavion luominen käsiteanalyysin avulla</td>
			<td>Tiedon lisääminen ja poistaminen</td>
		      </tr>
		      <tr>
			<td>4</td>
			<td></td>
			<td>Taulujen määrittely, rajoitteet</td>
			<td>Tiedon määrittely (DDL) ja tiedon muokkaaminen (DDM)</td>
		      </tr>
		      <tr>
			<td>5</td>
			<td></td>
			<td>Tiedon normalisointi</td>
			<td>Aggregaattikyselyt ja tilastojen luominen</td>
		      </tr>
		      <tr>
			<td>6</td>
			<td>Tehokkuus</td>
			<td>Indeksit ja hakurakenteet</td>
			<td></td>
		      </tr>
		      <tr>
			<td>7</td>
			<td>Muita datan esitysmuotoja</td>
			<td>Tietokantatransaktiot ja tiedon eheys</td>
			<td></td>
		      </tr>
		    </tbody>
		  </table>
		</div>


                <h1 id="kasitteisto">Kurssin käsitteistöä</h1>


		<div id="week-toc" class="nav">
		  <table class="table table-striped">
		    <thead>
		      <tr>
			<th>Käsite</th>
			<th>Selitys</th>
		      </tr>
		    </thead>
		    <tbody>
		      <tr>
			<td>wip</td>
			<td>work in progress, työn alla</td>
		      </tr>
		    </tbody>
		  </table>
		</div>

                <h1>Sisällysluettelo</h1>

                <ul class="nav" id="material-toc"></ul>

<!--
                <h1>Materiaalin itseopiskelu- ja kertaustehtävät</h1>

                <ul class="nav nav-pills nav-pills-fixed-width" id="tehtavat-toc"></ul>
-->
                <h1>Kurssin tehtävät</h1>

		<p>Kurssilla on viikosta 2 lähtien kotona tehtäviä tehtäviä sisältäviä tehtäväsarjoja, jonka lisäksi laskuharjoitustilaisuuksissa tehdään paikan päällä tehtäviä. Näiden lisäksi kurssimateriaalissa on erikseen merkittyjä pohdinta- ja SQL-ohjelmointitehtäviä.</p>

		<h2>Kotona tehtävät tehtäväsarjat</h2>

		<ul>
		  <li><a href="https://docs.google.com/document/d/18PXEYZGuLOO6p1F5HfjRLAZrsgqWuKcYhgnilHVtIrY/edit?usp=sharing" target="_blank">Viikko 2</a></li>
		  <li>Viikko 3 (julkaistaan 11.9.)</li>
		  <li>Viikko 4 (julkaistaan 18.9.)</li>
		  <li>Viikko 5 (julkaistaan 25.9.)</li>
		  <li>Viikko 6 (julkaistaan 2.10.)</li>
		  <li>Viikko 7 (julkaistaan 9.10.)</li>
		</ul>

		<h2>Paikan päällä tehtävät tehtäväsarjat</h2>
		
		<ul>
		  <li><a href="https://docs.google.com/document/d/18tYsgXU0u-6KFbuGft4yN3tkG0yxgE4DY0IdFx-C5Gg/edit?usp=sharing" target="_blank">Viikko 1</a></li>
		  <li>Viikko 2 (julkaistaan 9.9.)</li>
		  <li>Viikko 3 (julkaistaan 16.9.)</li>
		  <li>Viikko 4 (julkaistaan 23.9.)</li>
		  <li>Viikko 5 (julkaistaan 30.9.)</li>
		  <li>Viikko 6 (julkaistaan 7.10.)</li>
		  <li>Viikko 7 (julkaistaan 14.10.)</li>
		</ul>


            </section>
            <!-- END INDEX -->

            <!-- BEGIN WEEK1 -->
            <section class="weeklimit" data-week-id="1">


                <header>
                    <h1 id="viikko1">Viikko 1</h1>
                </header>

                <h1>Johdanto</h1>


		<p>Kävellessäsi Helsingin keskustassa näet ihmisvilinän, kuulet puheensorinan, huomaat uutisotsikoita, mainostauluja ja erilaisia laitteita, jotka tarjoavat monipuolista tietoa sinua ympäröivästä maailmasta. Vaikka tämä toiminta voi tuntua satunnaiselta, voit havaita siitä erilaisia sääntöjä ja hahmoja. Ihmiset kulkevat paikasta toiseen tietoisten tai tiedostamattomien tavoitteiden ohjaamina. Puhe tapahtuu tietyllä kielellä, jolla on oma kielioppi. Uutisotsikoilla on tietynlainen tekstityyli. Mainostaulut hakevat näytettävän mainoksen verkon yli, ja laitteet -- esimerkiksi kännykkäsi -- seuraavat niihin ohjelmoituja sääntöjä, osittain antamiesi komentojen ohjaamana.</p>

		<p>Nämä säännöt ja hahmot kuvaavat tiedon rakennetta. Osa tiedosta on jäsentelemätöntä, eli sille ei ole tarkasti määriteltyä muotoa. Esimerkiksi puheensorina voi poukkoilla teemasta toiseen, ja vastaavasti tietoisten ja tiedostamattomien tavoitteiden tarkka kirjaaminen olisi, ainakin, hyvin haastavaa.</p>

		<p>Toisaalta, voit lukea saman uutisen lähes sanasta sanaan lehdestä, kännykästäsi tai netistä, olettaen että uutispalvelun tarjoaja on sama. Uutinen on jäsennelty otsikkoon, johdantoon, ja tekstikappaleisiin sekä niihin liittyviin väliotsikkoihin. Eri järjestelmät näyttävät tämän tiedon eri tavalla, ja samalla tarjoavat uutistietoon erilaisen pääsyn. Toimittaja muokkaa ja katsoo uutista sen kirjoittamiseen tarkoitetun sisällönhallintajärjestelmän kautta, kännykällä uutista lukeva saattaa nähdä uutisen kännykän ominaisuuksiin mukautuvan web-sivuston kautta, ja uutisia listaava uutissivusto saattaa listata uutisesta vain sen otsikon.</p>

		<p>Puhekielessä termillä tietokanta tarkoitetaan yleisesti ottaen tiedon tallentamiseen tarkoitettua paikkaa, josta tietoa voi myös hakea. Esimerkiksi kirkonkirjat voidaan nähdä eräänlaisena sukujen historiaa dokumentoivana tietokantana, jonka kautta sukututkija pääsee käsiksi sukunsa historiaan. Vaikka tietokannat ovat digitalisaation myötä siirtymässä paperisesta muodosta sähköiseen muotoon, on niiden tavoite pysynyt pitkälti samana: <em>haluamme säilöä tietoa, ja haluamme päästä tähän tietoon käsiksi</em>. Tällä kurssilla käsittelemme elektronisia tietokantoja, joiden kehittyminen on johtanut tilanteeseen, missä tietoa tallennetaan yhä enemmän ja sitä halutaan hyödyntää yhä monipuolisemmin.</p>

		<aside class="info">
		  <br/>
		  <h1>Tutustu tietokantaan!</h1>

		  <p>Tässä kohtaa on erittäin hyvä hetki käydä tutustumassa muutamaan tietokantapalveluun. Osoitteessa <a href="http://hiski.genealogia.fi/hiski/" target="_blank">http://hiski.genealogia.fi/hiski/</a> on Suomen Sukututkimusseuran ylläpitämä Historiakirjojen hakupalvelu. Käy sivulle, valitse kieli, etsi "Kaikista", ja valitse "Kastetut".</p>

		  <p>Minkälaisia tuloksia löydät omalla etunimelläsi? Entä, minkälaisia tuloksia löydät nimillä Matti ja Maija? Palvelu pyrkii muunmuassa sisällyttämään läheiset nimien muunnokset hakutuloksiin, sillä nimet muuttuvat ajan myötä. </p>
		</aside>

		<p>Nykyään tietokantoja on kaikkialla. Tämä kurssimateriaali sijaitsee tietokannassa, kurssitehtäviin liittyvät pisteet kirjataan tietokantaan, ja tehdessäsi kurssilla tarpeeksi töitä kurssiin liittyvien oppimistavoitteiden saavuttamiseksi kurssista kirjataan suoritusmerkintä tietokantaan. Jo pelkästään nykyaikaisessa kännykässäsi on kymmeniä erilaisia tietokantoja; yhteystiedot, kalenteri, herätyskello, aikavyöhykkeet, karttapalvelut, suosikkiverkkosivut, jonka lisäksi moni kännykkäsovellus hyödyntää yhtä tai useampaa tietokantaa. Tietokannat voivat olla paikallisia, eli ne voivat sijaita samalla koneella tietokantaa käyttävän ohjelmiston kautta, esimerkiksi kännykässä, tai ne voivat sijaita erillisellä palvelimella, johon otetaan tarvittaessa yhteyttä. Loppukäyttäjän näkökulmastasi tällä ei kuitenkaan ole juurikaan merkitystä. Näet tietokannasta haetun tiedon käyttämäsi sovelluksen tarjoaman näkymän kautta.</p>


		<aside class="info">
		  <br/>
		  <h1>Tieto toistuu, monistuu, ja yhdistyy</h1>

		  <p>Moni tietokantaa käyttävä palvelu käyttää henkilöihin liittyviä tietoja, kuten osoitetta, puhelinnumeroa tai sähköpostiosoitetta. Kun rekisteröidyt verkossa oleviin palveluihin, on tyypillistä, että ne pyytävät vähintään sähköpostiosoitteen. Nämä tiedot tallentuvat kuitenkin palvelu- tai yrityskohtaisiin tietokantoihin, josta niitä mahdollisesti yhdistellään.</p>

		  <p>Pohdi, kuinka moneen palveluun olet syöttänyt sähköpostiosoitteesi? Entä nimesi tai syntymäpäiväsi? Tyypillisesti moni näistä palveluista on erillinen, mutta, tulevaisuudessa tätä tietoa tullaan yhdistämään yhä enemmän ja enemmän paremman yleiskuvan saamiseksi, sekä tilastoihin perustuvien päätösten tekemiseksi.</p>
		  <p>Esimerkiksi sekä sähkö- että peliyhtiöt kummatkin hyötyvät merkittävästi saadessaan tietoa palvelun käyttöasteesta. Sähköyhtiöt voivat käyttää tätä tietoa sähkön tarpeen ennustamiseen, jonka avulla sähkön tuottoa voidaan säännöstellä -- peliyhtiöt taas voivat muunmuassa hyödyntää käyttötilastoja pelin toimivien ja ei-toimivien osa-alueiden kehittämiseen.</p>

		</aside>

		<p>Käytämme tällä kurssilla yhtenä esimerkkinä opiskelun ja oppimisen seuraamiseen tarkoitettua järjestelmää, joka kehittyy materiaalin edetessä. Järjestelmä pitää kirjaa kursseista, opiskelijoista, kurssiharjoituksista, arvosanoista, kurssipalautteista, sekä muista oleellisista asioista, joita kurssin edetessä tulee esille. Jotta tämä onnistuisi, tarvitsemme jonkinlaisen jäsentelytavan eli rakenteen tallennettavalle tiedolle, tapoja tiedon tallentamiseen tässä sovitussa muodossa, sekä tapoja erilaisten raporttien luomiseen. Katsotaan miten käy..</p>

		<!--
		    Tilanteeseen luonnollisesti vaikuttaa myös se, kun järjestelmää alkaa käyttämään useampi käyttäjä...
		  -->


		<h2>Tietokanta ja tiedon rakenteen kuvaaminen</h2>

		<p>Tietokanta on kokoelma tiettyyn aihepiiriin liittyviä säilytettäviä tietoja. Tietokannan luominen liittyy usein jonkinlaisen organisaation, yrityksen tai muun yhteisön tarpeeseen säilöä ja hakea tietoa. Esimerkiksi yliopisto haluaa pitää kirjaa opiskelijoistaan ja heidän opintomenestystään, hotelli haluaa pitää kirjaa hotellin huoneiden varauksista, ja kauppaketju haluaa pitää kirjaa asiakkaistaan ja asiakkaiden ostoksista.</p>

		<p>Tallennettava tieto liittyy tyypillisesti johonkin tavoitteeseen. Yliopisto haluaa seurata opintojen etenemistä esimerkiksi valtionhallinnolle raportointia varten, huoneiden varaustilannetta seuraava hotelli taas haluaa tietää milloin huoneita on paljon tarjolla, ja milloin huoneet ovat lopussa. Kauppaketjun ensisijaisena tavoitteena on asiakkaiden ostosten seuranta myynnin optimoimiseksi.</p>

		<p>Tietokantojen rakennetta ja jäsentelyä suunniteltaessa ongelmaa lähestytään tavoitteeseen liittyvien käsitteiden kautta, joiden avulla pyritään ymmärtämään mikä tiedosta on epäoleellista, ja mikä tulee säilöä. Samalla mietitään myös säilöttävien käsitteiden ominaisuuksia sekä käsitteiden suhteita. Esimerkiksi opiskelijan opintomenestyksen seurannassa oleellisia ovat ainakin käsitteet <em>Opiskelija</em> ja <em>Kurssisuoritus</em>, joilla on yhteys: opiskelijalla on kurssisuorituksia.</p>

		<p>Tällä kurssilla tiedon mallintamiseen käytetään <a href="http://www.uml.org/" target="_blank">UML</a>-kieltä, johon syvennytään tarkemmin kurssilla <em>Ohjelmistotekniikan menetelmät</em>. Käytämme <a href="https://fi.wikipedia.org/wiki/Luokkakaavio" target="_blank">luokkakaavioita</a> käsitteiden ominaisuuksien ja suhteiden mallintamiseen, mutta, emme kuitenkaan seuraa kuvaustapaa pilkuntarkasti.</p>

		<figure>
		  <img src="img/johdanto/opiskelija-ja-kurssisuoritus-erilliset-kasitteet.png" alt="Teksti 'Opiskelija' suunnikkaan sisään kirjoitettuna, Teksti 'Kurssisuoritus' toisen suunnikkaan sisään kirjoitettuna.">
		  <figcaption>Käsitteet kuvataan laatikkoina, joiden sisällä on käsitteen nimi. Yllä käsitteet Opiskelija ja Kurssisuoritus.</figcaption>
		</figure>

		<p>Jos haluamme ilmaista, että käsite liittyy toiseen käsitteeseen, piirrämme käsitteiden välille viivan. Viivan kumpaankin päätyyn merkitään osallistumisrajoitteet, joilla kuvataan sitä, että kuinka monessa samantyyppisessä yhteydessä käsitteen ilmentymä voi olla. Jos ilmentymään voi liittyä tasan yksi toisen tyyppinen ilmentymä, lisäämme nuolen päähän numeron yksi. Toisaalta, jos ilmentymien määrä on rajoittamaton, lisäämme viivan päähän tähden. Alla olevassa kaaviossa on käsitteet Opiskelija ja Kurssisuoritus, sekä viiva käsitteiden välillä. Yhteen kurssisuoritukseen liittyy aina tasan yksi opiskelija, mutta yhdellä opiskelijalla voi olla useampia kurssisuorituksia.</p>

		<figure>
		  <img src="img/johdanto/opiskelija-ja-kurssisuoritus-ei-attribuutteja.png" alt="Teksti 'Opiskelija' suunnikkaan sisään kirjoitettuna, Teksti 'Kurssisuoritus' toisen suunnikkaan sisään kirjoitettuna. Suunnikkaiden välille on piirretty viiva, jonka Kurssisuoritus-käsitteen päässä on tähti.">
		  <figcaption>Opiskelijaan liittyy useita kurssisuorituksia, mutta jokaiseen kurssisuoritukseen liittyy tasan yksi opiskelija.</figcaption>
		</figure>

		<p>Käsitteisiin kuuluu tyypillisesti ominaisuuksia. Ominaisuudet merkitään laatikkoon käsitteen nimen alle. Alla olevassa kuvassa Opiskelija-käsitteeseen liittyy ominaisuudet nimi, syntymävuosi ja pääaine.</p>

		<figure>
		  <img src="img/johdanto/opiskelija-ja-ominaisuudet.png" alt="Teksti 'Opiskelija' suunnikkaan sisään kirjoitettuna, suunnikkaan alalaidassa kiinni toinen suunnikas, jossa tekstit 'nimi', 'syntymävuosi' ja 'pääaine' omilla riveillään. ">
		  <figcaption>Käsitteillä voi olla ominaisuuksia. Opiskelija-käsitteeseen liittyy nimi, syntymävuosi, ja pääaine.</figcaption>
		</figure>

		<p>Myös kurssisuoritukseen liittyy ominaisuuksia. Alla opiskelijaan liittyy useita kurssisuorituksia, jonka lisäksi käsitteisiin liittyvät ominaisuudet on myös merkitty.</p>

		<figure>
		  <img src="img/johdanto/opiskelija-ja-kurssisuoritus.png" alt="Teksti 'Opiskelija' suunnikkaan sisään kirjoitettuna, Teksti 'Kurssisuoritus' toisen suunnikkaan sisään kirjoitettuna. Suunnikkaiden välille on piirretty viiva, jonka Kurssisuoritus-käsitteen päässä on tähti. Käsitteiden alla on myös niiden ominaisuudet kuten edellisessä kuvassa.">
		  <figcaption>Opiskelijaan liittyy useita kurssisuorituksia. Käsitteille on merkitty myös ominaisuudet.</figcaption>
		</figure>

		<p>Kun piirrät kaavioita, älä käytä piirtämiseen liikaa aikaa. Oleellisinta on se, että tärkeät asiat ovat paperilla. Jos huomaat, että käytät liikaa aikaa, heitä paperi roskiin, ja aloita alusta.</p>

		<aside class="info">
		  <br/>

		  <h1>Pientä pohdintaa!</h1>

		  <p>Hahmottele paperille seuraavaan kuvaukseen liittyvä kaavio yllä esitetyllä tavalla. Mitkä ovat käsitteet, ja miten ne liittyvät toisiinsa?</p>

		  <p><em>Opettajalla on useita kursseja, joita hän opettaa. Jokaiseen kurssiin liittyy ajankohta, jolloin kurssi järjestetään, sekä kurssin käyttämä sali.</em></p>

		  <p>Mitä voimme sanoa opettajan kalenterista kuvauksen perusteella? Entä salien varaustilanteesta?</p>

		</aside>

		<p>Käsitteitä ja niiden sisältämää tietoa voidaan ajatella tauluna, jossa jokainen rivi kuvaa yksittäistä käsitteen ilmentymää.</p>
		
		<div class="data-table">
		  <h4>Opiskelija</h4>
		  <table class="table">
		    <thead>
		      <tr>
			<th>nimi</th>
			<th>syntymävuosi</th>
			<th>pääaine</th>
		      </tr>
		    </thead>
		    <tbody>
		      <tr>
			<td>Pihla</td>
			<td>1997</td>
			<td>Tietojenkäsittelytiede</td>
		      </tr>
		      <tr>
			<td>Joni</td>
			<td>1993</td>
			<td>Tietojenkäsittelytiede</td>
		      </tr>
		      <tr>
			<td>Anna</td>
			<td>1991</td>
			<td>Matematiikka</td>
		      </tr>
		      <tr>
			<td>Krista</td>
			<td>1990</td>
			<td>Tietojenkäsittelytiede</td>
		      </tr>
		      <tr>
			<td>Matti</td>
			<td>1970</td>
			<td>Matematiikka</td>
		      </tr>
		      <tr>
			<td>Gandhi</td>
			<td>1869</td>
			<td>Oikeustiede</td>
		      </tr>
		    </tbody>
		  </table>
		</div>

		<p>Vastaavasti myös kurssisuorituksia kuvaamaan voisi tehdä oman erillisen taulun.</p>

		<aside class="info">

		  <br/>

		  <h1>Ensiaskeleita tiedon yhdistämiseen</h1>

		  <p>Kysymykseksi nousee "<em>Miten yhdistämme Opiskelijaa kuvaavan taulun ja Kurssisuoritusta kuvaavan taulun tietoja?</em>". Olio-ohjelmoinnissa Kurssisuoritusolio sisältäisi viitteen Opiskelijaolioon, tai mahdollisesti, jokainen Opiskelijaolio sisältäisi listan viitteitä Kurssisuoritusolioon.</p>

		  <p>Olio-ohjelmoinnissa viite on oikeastaan osoite muistipaikkaan, missä olion tiedot ovat. Voisiko kurssisuoritukseen lisätä jonkinlaisen muistiviitteen opiskelijaan? Palaamme tähän relaatiomallin ja relaatiotietokantojen yhteydessä.</p>

		</aside>

<!--
		<p>[tehtävä: ideointia yhdistämistapoihin, johdattelua relaatiomalliin?]</p>
-->

		<h2>Tietokannanhallintajärjestelmä</h2>

		<p>Tietokanta sijaitsee tyypillisesti tietokannanhallintajärjestelmässä, jonka kautta tietokantaan pääsee käsiksi. Tietokannanhallintajärjestelmän vastuulla on tietokantaan kohdistuvien haku-, muokkaus- ja lisäystoimintojen toiminnan lisäksi käyttöoikeuksien valvominen. Yksittäisessä tietokannanhallintajärjestelmässä voi kustannus- ja tehokkuussyistä sijaita useisiin erilaisiin sovelluksiin ja käyttötarkoituksiin liittyviä tietokantoja, joita jokaista käyttää eri käyttäjät tai eri yritys.</p>

		<p>Yksittäinen sovellus voi käyttää myös useampaa tietokantaa, jotka sijaitsevat eri tietokannanhallintajärjestelmissä. Tyypillinen esimerkki tällaisesta sovelluksesta on analytiikkapalvelu, joka yhdistää eri palveluiden tallentamaa tietoa yhteenvetoraporttien luomiseksi.</p>


		<p>Tietokannanhallintajärjestelmän vastuulla on myös tiedon eheyteen liittyvien sääntöjen noudattamisen valvonta. Tietokannassa voi olla esimerkiksi sääntö "Opiskelijan syntymävuoden tulee sisältää neljä numeroa", jolloin uusien opiskelijoiden lisääminen ilman oikein määriteltyä syntymävuotta ei voida lisätä tietokantaan. Vastaavia sääntöjä voidaan lisätä muunmuassa varausjärjestelmiin, esimerkiksi lentokoneiden paikkavarausjärjestelmissä halutaan varmistaa, että jokaisella istuimella on korkeintaan yksi varaus. Vastaavasti, tietokannanhallintajärjestelmän vastuulla on varmistaa, että tietoa ei tuhoudu, vaikka tietokantaa käyttävä järjestelmä hajoaisi -- erilaiset varmuuskopiotoiminnallisuudet ovat tyypillisiä.</p>

		<p>Tämän lisäksi, tietokannanhallintajärjestelmät tarjoavat tyypillisesti välineitä tiedon hakemiseen liittyvien toimintojen tehokkuuden tarkastelemiseen. Vaikka opintojen seurantaan liittyvä järjestelmämme sisältäisi tiedot kaikista Helsingin yliopiston opiskelijoista (n. 35000), sekä kaikista kurssisuorituksista (rutkasti), tulisi tietokantaan tehtävien kyselyjen toimia silti mielekkäässä ajassa. Edellämainittukin tietomäärä on esimerkiksi Amazon-verkkokaupan mittakaavassa hyvin pieni.</p>

		<p>Vaikka tietokantaa käyttävän sovelluksen tehokkuuteen vaikuttaa tietokone tai palvelin, jolle sovellus on asennettu, emme tällä kurssilla ota juurikaan kantaa ns. rautatason toimintaan.</p> 


		<aside class="extra">

		  <h1>Historian siipien havinaa</h1>


		  <p>Tiedon tallentamiseen käytettiin alunperin tekstitiedostoja, joiden välillä tietoa pyrittiin yhdistämään joko manuaalisesti tai ohjelmallisesti. Ensimmäisten tietokannanhallintajärjestelmien yhteydessä siirryttiin tiedon todellisen tallennusmuodon abstrahointiin käyttäjältä, ja tietoa käsiteltiin erillisen ohjelmointirajapinnan kautta. Tiedon linkittäminen tapahtui käytännössä muistiviitteiden avulla, jolloin tiedon hakemiseen liittyi näiden muistiviitteiden kautta navigoiminen, johon tarvittiin asiaan erikoistunut ohjelmoija.</p>

		  
		  <p>Navigointiin perustuvissa järjestelmissä yhtenä ongelmana oli kuitenkin se, että ohjelmoijan tuli korjata järjestelmän navigointirakenne kun rakenne muuttui. Jos tietokannasta poistettiin yksittäinen tietue, saattoi huonoimmassa tapauksessa tietueen kautta löydettävät asiat kadota poiston yhteydessä.</p>
		  
		  <p>Koska tiedon hakeminen oli tyypillisesti hidasta, tietoa tallennettiin useampaan paikkaan navigoimisen vähentämiseksi. Kun tietokoneet kehittyivät, toistetun tiedon käyttämistä voitiin vähentää, ja samalla yksittäistä tietokannanhallintajärjestelmää pystyi käyttämään useampi ohjelmoija ja ohjelma. Suurin viimeaikainen kehitysaskel tapahtui kuitenkin relaatiotietomallin esittelyn yhteydessä, missä vastuu navigointiin liittyvien polkujen tekemisestä jätetään täysin ohjelmoijan vastuulle.</p>

		  <p>Lue osoitteessa <a href="http://www.tomandmaria.com/Tom/Writing/HowThe%20DataGotItsBase.pdf" target="_blank">http://www.tomandmaria.com/Tom/Writing/HowThe%20DataGotItsBase.pdf</a> oleva Thomas Haighin kirjoittama katsaus tietokantojen historiaan.</p>

		</aside>


<!--
		<h2>Tiedon käsittely ohjelmallisesti</h2>


		<p>TODO: halutaanko case?</p>
-->


		<h1>Johdanto relaatiomalliin ja relaatiotietokantoihin</h1>


		<p>Relaatiomallin perusajatus on tallennettavan tiedon jakaminen käsitteisiin sekä käsitteiden välisiin yhteyksiin. Jokaista käsitettä vastaa relaatiotietokannassa taulu, ja jokaiselle käsitteen ominaisuudelle eli attribuutille on taulussa oma sarake. Jokainen taulun rivi vastaa yhtä käsitteen ilmentymää, ja tietokantatauluja määriteltäessä taululle määritellään tyypillisesti myös <em>avain</em>, jonka perusteella kukin rivi -- eli käsitteen ilmentymä -- voidaan yksilöidä.

		<p>Kun pohdimme Opiskelija-käsitettä, jolla on nimi, syntymävuosi, ja pääaine, huomaamme, että opiskelijan yksilöinti olemassaolevien tietojen perusteella on lähes mahdotonta. Esimerkiksi vuonna 1991 syntyneitä matematiikkaa opiskelevia Anna-nimisiä opiskelijoita löytyy useampia.</p>

		<p>Luodaan Opiskelija-käsitteestä tietokantataulu. Tietokantataulussa opiskelija-käsitteelle määritellään opiskelijan yksilöivä avain, jonka lisäksi muut käsitteeseen liittyvät attribuutit lisätään tietokantataulun sarakkeiksi. Tietokantataulun voi piirtää kaaviona kuten alla -- yksilöivän avaimen voi merkitä joko alleviivaamalla käsitteen, tai merkitsemällä käsitteen eteen merkki <em>(pk)</em>, eli <em>primary key</em>.</p>

		<figure>
		  <img src="img/johdanto/opiskelija-ja-opiskelijanumero.png" alt="[Opiskelija|(pk) opiskelijanumero;nimi;syntymävuosi;pääaine]">
		  <figcaption>Opiskelija-taulua luodessa opiskelijaan on lisätty jokaisen opiskelijan yksilöivä avain, tässä tapauksessa opiskelijanumero. Avain on merkitty tekstillä (pk) sen selkeyttämiseksi.</figcaption>
		</figure>


		<p>Tietokantataulussa oleva data voi näyttää esimerkiksi seuraavalta:</p>
		
		<div class="data-table">
		  <h4>Opiskelija</h4>
		  <table class="table">
		    <thead>
		      <tr>
			<th>opiskelijanumero</th>
			<th>nimi</th>
			<th>syntymävuosi</th>
			<th>pääaine</th>
		      </tr>
		    </thead>
		    <tbody>
		      <tr>
			<td>9999999</td>
			<td>Pihla</td>
			<td>1997</td>
			<td>Tietojenkäsittelytiede</td>
		      </tr>
		      <tr>
 			<td>9999998</td>
			<td>Joni</td>
			<td>1993</td>
			<td>Tietojenkäsittelytiede</td>
		      </tr>
		      <tr>
			<td>...</td>
			<td></td>
			<td></td>
			<td></td>
		      </tr>
		    </tbody>
		  </table>
		</div>

		<p>Opiskelija-käsitteeseen liittyy useampi Kurssisuoritus, mikä näyttää luokkakaaviona seuraavalta -- allaolevassa luokkakaaviossa Opiskelijaan on lisätty opiskelijanumero:</p>

		<figure>
		  <img src="img/johdanto/opiskelija-opiskelijanumerolla-ja-kurssisuoritus.png" alt="Teksti 'Opiskelija' suunnikkaan sisään kirjoitettuna, Teksti 'Kurssisuoritus' toisen suunnikkaan sisään kirjoitettuna. Suunnikkaiden välille on piirretty viiva, jonka Kurssisuoritus-käsitteen päässä on tähti. Käsitteillä myös ominaisuudet. ">
		  <figcaption>Opiskelijaan liittyy yksi tai useampi kurssisuoritus.</figcaption>
		</figure>


		<p>Relaatiotietokannoissa käsitteiden yhdistäminen tapahtuu avainten avulla. Tietokantatauluun Opiskelija on määritelty jokaisen opiskelijan yksilöivä avain <em>opiskelijanumero</em>. Koska jokaiseen opiskelijaan voi liittyä useampi kurssisuoritus, mutta jokaiseen kurssisuoritukseen vain yksi opiskelija, voimme lisätä kurssisuoritustaulua luodessa siihen <em>viiteavaimen</em> (foreign key), joka viittaa opiskelijaan. Kurssisuoritus-tauluun lisätään siis sarake nimeltä opiskelija, joka sisältää aina kurssisuoritukseen liittyvän opiskelijan opiskelijanumeron. Viiteavain merkitään tekstillä <em>(fk)</em>, eli <em>foreign key</em>, ja viiteavaimen nimen jälkeen tulee Taulun nimi, johon viiteavain viittaa.</p>

		<figure>
		  <img src="img/johdanto/opiskelija-opiskelijanumerolla-ja-kurssisuoritus-taulut.png" alt="[Opiskelija|(pk) opiskelijanumero;nimi;syntymävuosi;pääaine]1-*[Kurssisuoritus|(fk) opiskelija: Opiskelija;kurssi;päivämäärä;arvosana]">
		  <figcaption>Opiskelijaan liittyy yksi tai useampi kurssisuoritus.</figcaption>
		</figure>


		<p>Tietokantataulussa Kurssisuoritus oleva data näyttää esimerkiksi seuraavalta:</p>

		<div class="data-table">
		  <h4>Kurssisuoritus</h4>
		  <table class="table">
		    <thead>
		      <tr>
			<th>opiskelija</th>
			<th>kurssi</th>
			<th>päivämäärä</th>
			<th>arvosana</th>
		      </tr>
		    </thead>
		    <tbody>
		      <tr>
			<td>9999999</td>
			<td>Ohjelmoinnin perusteet</td>
			<td>1.8.2014</td>
			<td>5</td>
		      </tr>
		      <tr>
			<td>9999999</td>
			<td>Ohjelmoinnin jatkokurssi</td>
			<td>1.8.2014</td>
			<td>5</td>
		      </tr>		      
		      <tr>
			<td>9999999</td>
			<td>Tietokantojen perusteet</td>
			<td>20.10.2014</td>
			<td>3</td>
		      </tr>
		      <tr>
			<td>...</td>
			<td></td>
			<td></td>
			<td></td>
		      </tr>		      
		      <tr>
 			<td>9999998</td>
			<td>Ohjelmoinnin perusteet</td>
			<td>1.8.2013</td>
			<td>4</td>
		      </tr>
		      <tr>
			<td>...</td>
			<td></td>
			<td></td>
			<td></td>
		      </tr>
		    </tbody>
		  </table>
		</div>

		<p>Ylläolevat taulut voidaan määritellä myös tekstimuodossa seuraavasti: </p>

		<ul>
		  <li>Opiskelija(<u>opiskelijanumero</u>, nimi, syntymävuosi, pääaine)</li>
		  <li>Kurssisuoritus(opiskelija->Opiskelija, kurssi, päivämäärä, arvosana)</li>
		</ul>

		<p>Opiskelijaan liittyvä opiskelijanumero on alleviivattu, sillä se on Opiskelija-taulun avain. Kurssisuoritustaulun merkintä <code>opiskelija->Opiskelija</code> taas tarkoittaa, että opiskelija on viiteavain, ja viittaa Opiskelija-taulun avaimeen.</p>


		<p>Pohditaan seuraavaksi kyselyiden tekemistä näihin tauluihin.</p>


		<h2>SQL-kyselykieli</h2>

		<p>SQL on kyselykieli relaatiotietokantojen käsittelyyn. Sen avulla voidaan hakea tietoa tietokannasta, päivittää tietokannassa olevaa tietoa, sekä muokata ja luoda tietokannan rakennetta. Käytännössä kaikki relaatiotietokantoja tukevat tietokannanhallintajärjestelmät käyttävät myös SQL-kieltä. </p>

		<p>Parhaiten kyselykieltä ymmärtää sitä harjoittelemalla. Sitä teemme paljon.</p>

		<aside class="info">

		  <br/>
		  <h1>Ohjeita SQL-tehtävien tekemiseen</h1>

		  <p>Kurssimateriaalissa on tästä kohdasta eteenpäin interaktiivisia SQL-tehtäviä, joiden avulla pääset harjoittelemaan SQL-kyselykielen käyttöä. Materiaali sisältää materiaalin edetessä täydentyvän opiskelijoiden kurssisuorituksia kuvaavan tietokannan, jota käytetään ellei toisin mainita. Lähes jokaisen esimerkkikyselyn voi suorittaa, jolloin kysely ajetaan tietokannassa ja kyselyn tulos näytetään ruudulla. Kyselyn suorittaminen tapahtuu <em>Suorita</em>-nappia painamalla.</p>

		  <p>Useimpien suoritettavien esimerkkien jälkeen avautuu muutama tehtävä, jossa pääset harjoittelemaan esimerkkiä vastaavien kyselyjen tuottamista.</p>

		</aside>

		<!-- viikon 1 SQL-tehtävät alkaa -->
		<div ng-controller="weekOneSqlController">


		  <h4>SELECT * FROM <em>Taulu</em></h4>
		  
		  <p>Avainsanalla <code>SELECT</code> valitaan tietyt sarakkeet kyselyn kohteena olevasta taulusta. Sarakkeet määritellään <code>SELECT</code>-avainsanan jälkeen. Jos ohjelmoija haluaa valita kaikki taulussa olevat sarakkeet, käytetään sarakkeiden valinnassa tähteä (<code>*</code>). Sarakkeiden määrittelyä seuraa avainsana <code>FROM</code>, jonka jälkeen kerrotaan kyselyn kohteena oleva taulu.</p>
		  
		  <p>Alla voit kokeilla kyselyn tekemistä aiemmin määriteltyihin <code>Opiskelija</code> ja <code>Kurssisuoritus</code>-tauluihin.</p>
		  
		  
		  <query
		     db="db"
		     query="SELECT * FROM Opiskelija"
		     editable="false"
		     done="listAllStudentsDone">
		  </query>
		  
		  <div ng-show="listAllStudentsDone">
		    
		    <h4>Tehtävät</h4>
		    
		    <p>Tee nyt kysely, jolla saat listattua <code>Kurssisuoritus</code>-taulussa olevat rivit.</p>
		    
		    <togglable content="taulut">
                      <table-info></table-info>
		    </togglable>
		    
		    <query db="db"></query>
		  </div>
		  

		  
		  <h4>SELECT <em>sarake, toinen</em> FROM <em>Taulu</em></h4>
		  
		  <p>Avainsanan <code>SELECT</code> jälkeen voidaan määritellä valittavat sarakkeet. Tähteä käyttämällä valitaan kaikki sarakkeet, mutta ohjelmoija voi valita myös yksittäisiä sarakkeita. Jos tähteä ei käytetä, ja halutaan valita useampia sarakkeita, valittavat sarakkeet erotellaan pilkulla.</p>
		  
		  
		  <query
		     db="db"
		     query="SELECT nimi, syntymävuosi FROM Opiskelija"
		     editable="false"
		     done="listAllStudentsWithAttributesDone">
		  </query>
		  
		  <div ng-show="listAllStudentsWithAttributesDone">
		    
		    <h4>Tehtävät</h4>
		    
		    <p>Tee nyt kysely, jolla saat listattua <code>Kurssisuoritus</code>-taulussa olevat kurssit.</p>
		    
		    <togglable content="taulut">
                      <table-info></table-info>
		    </togglable>
		    
		    <query db="db"></query>
		  </div>


		  <h4>SELECT <em>DISTINCT</em> <em>sarake</em> FROM <em>Taulu</em></h4>
		  
		  <p>Kun haimme edellisessä harjoitteluosiossa Kurssisuoritus-taulussa olevien kurssien nimiä, huomasimme, että muutamat kurssien nimet näkyivät useampaan otteeseen. Tämä johtuu siitä, että kysely valitsee taulun rivit, ja taulussa yksinkertaisesti oli useampia rivejä, joilla esiintyi samat kurssit.</p>

		  <p>Avainsanalla <code>DISTINCT</code> voidaan valita vain uniikit vastausrivit. Avainsana <code>DISTINCT</code> tulee avainsanan <code>SELECT</code> jälkeen.</p>
		  
		  
		  <query
		     db="db"
		     query="SELECT DISTINCT pääaine FROM Opiskelija"
		     editable="false"
		     done="listDistinctMajorsDone">
		  </query>
		  
		  <div ng-show="listDistinctMajorsDone">
		    
		    <h4>Tehtävät</h4>
		    
		    <p>Tee nyt kysely, jolla saat listattua <code>Kurssisuoritus</code>-taulussa olevat <em>uniikit</em> kurssit.</p>
		    
		    <togglable content="taulut">
                      <table-info></table-info>
		    </togglable>
		    
		    <query db="db"></query>
		  </div>



		  <h4>SELECT * FROM <em>Taulu</em> <em>WHERE</em>...</h4>
		  
		  <p>Emme tyypillisesti kuitenkaan halua valita kaikkea taulussa olevaa dataa, vaan vain tietyt hakuehdot täyttävän osajoukon. Avainsanan <code>WHERE</code> avulla kyselyille annetaan hakuehtoja. Hakuehtojen perusteella kyselyn tulokseen valitaan vain ne rivit, joissa hakuehdossa määritellyn sarakkeen arvot täyttävät hakuehdon. Hakuehto voi olla esimerkiksi muotoa <code>...WHERE nimi = 'Joni'</code>, jolloin valittaisiin vain ne rivit, joissa sarakkeen <code>nimi</code> arvo on <code>'Joni'</code>.</p>

		  <query
		     db="db"
		     query="SELECT * FROM Opiskelija WHERE nimi = 'Joni'"
		     editable="false"
		     done="selectJoniDone">
		  </query>
		  
		  <div ng-show="selectJoniDone">
		    
		    <h4>Tehtävät</h4>
		    
		    <p>Tee nyt kysely, jolla saat listattua <code>Opiskelija</code>-taulusta kaikki ne opiskelijat, joiden nimi on 'Anna'.</p>
		    
		    <togglable content="taulut">
                      <table-info></table-info>
		    </togglable>
		    
		    <query db="db" done="selectAnnaDone"></query>


		    <div ng-show="selectAnnaDone">
		    
		      <p>Tee nyt kysely, jolla saat listattua <code>Kurssisuoritus</code>-taulusta kaikki Pihla-nimisen opiskelijan suoritukset. Voit olettaa, että Opiskelija-taulun sisältö on täsmälleen se, kuin mikä se tähän asti on ollut.</p>
		    
		      <togglable content="taulut">
			<table-info></table-info>
		      </togglable>
		      
		      <query db="db"></query>

		    </div>
		  </div>

		  <aside class="info">
		    <br/>
		    <h1>SQL-kyselyiden kirjainkoko</h1>
		    
		    <p>SQL on "case insensitive", eli sillä, että onko kysely kirjoitettu isolla vai pienellä ei ole kyselyn suorituksen kannalta merkitystä. Voimme kirjoittaa komennon <code>SELECT</code> yhtä hyvin muodossa <code>select</code> tai <code>Select</code> -- sama pätee myös taulujen nimille ja attribuuteille.</p>

		    <p>Taulussa olevaa dataa tarkasteltaessa kirjainkoolla on kuitenkin merkitystä. Kun teemme esimerkiksi vertailuoperaatioita merkkijonoille, on merkkijonon kirjoitusasu tärkeä. Kysely <code>SELECT * FROM Opiskelija WHERE nimi = 'Joni'</code> palauttaa vain ne opiskelijat, joiden nimi-kentän arvo on <em>täsmälleen</em> 'Joni'. Jos rivillä olevan nimi-kentän arvo olisi vaikkapa 'joni', ei edellinen kysely valitsisi kyseistä riviä.</p>

		    <p>Noudatamme tällä kurssilla seuraavaa käytäntöä:</p>

		    <ol>
		      <li>Kaikki SQL-kielen komennot, kuten <code>SELECT</code>, <code>FROM</code> ja <code>WHERE</code>, kirjoitetaan isolla.</li>
		      <li>Taulujen nimet kirjoitetaan isolla alkukirjaimella. Esimerkiksi <code>Opiskelija</code> ja <code>Kurssisuoritus</code>.</li>
		      <li>Taulujen sarakkeet eli attribuutit kirjoitetaan pienellä. Esimerkiksi <code>nimi</code> ja <code>kurssikoodi</code>.</li>
		    </ol>

		  </aside>


		  <p>Kyselyissä toimivat myös suurempi kuin <code>&gt;</code> ja pienempi kuin <code>&lt;</code> -operaatiot.</p>

		  <p>Jos sarakkeen arvot ovat merkkijonoja, kuten kurssin nimi ja opiskelijan nimi, voi hakuehdossa käyttää myös <code>LIKE</code>-operaatiota. Tämän avulla hakutuloksia voi rajata osittaisen merkkijonon avulla. Esimerkiksi kysely <code>SELECT * FROM Opiskelija WHERE nimi LIKE '%a%'</code> hakee kaikki opiskelijat, joiden nimessä esiintyy pieni a-kirjain.</p>


		  <query
		     db="db"
		     query="SELECT * FROM Opiskelija WHERE nimi LIKE '%a%'"
		     editable="false"
		     done="listOpiskelijatWithSmallAInName">
		  </query>
		  
		  <div ng-show="listOpiskelijatWithSmallAInName">
		    
		    <h4>Tehtävät</h4>
		    
		    <p>Tee nyt kysely, jolla saat listattua kaikki Opiskelija-taulussa olevat pääaineet, joissa esiintyy sana "tiede". </p>
		    
		    <p>Huom! Tee kysely siten, että näet vain uniikit vastaukset. Kyselyn vastauksessa pitäisi olla vain 2 riviä. Kun saat kyselyn toimimaan, kokeile mitä tapahtuu jos muutat 'LIKE'-operaation muotoon 'NOT LIKE'.</p>
		    
		    <togglable content="taulut">
                      <table-info></table-info>
		    </togglable>
		    
		    <query db="db"></query>
		  </div>
		  
		</div>


		<aside class="info">
		  <br/>

		  <h1>Loogiset operaatiot 'ja' ja 'tai'</h1>

		  <p>Rajausehtoihin voi myös lisätä loogisia operaatioita kyselyjen tulosten tajaamiseksi. Operaatio 'ja', eli kahden rajausehdon yhdistäminen, toimii avainsanalla <code>AND</code>. Esimerkiksi kysely <code>SELECT * FROM Kurssisuoritus WHERE Kurssi = 'Ohjelmoinnin perusteet' AND Arvosana = 5</code> listaisi vain ne Ohjelmoinnnin perusteet -kurssin suoritukset, missä arvosana on 5.</p>

		  <p>Operaation 'tai' lisääminen on myös mahdollista. Esimerkiksi kysely <code>SELECT * FROM Kurssisuoritus WHERE Kurssi = 'Ohjelmoinnin perusteet' OR Kurssi = 'Ohjelmoinnin jatkokurssi'</code> listaisi kaikki ne kurssisuoritukset, joissa kurssi on joko ohjelmoinnin perusteet tai ohjelmoinnin jatkokurssi.</p>

		  <p>Ehtoja voi myös yhdistää, jonka lisäksi suluilla voi rajata suoritusjärjestystä. Ota selvää mitä kysely <code>SELECT * FROM Kurssisuoritus WHERE (Kurssi = 'Ohjelmoinnin perusteet' OR Kurssi = 'Ohjelmoinnin jatkokurssi') AND Arvosana = 3</code> tekee.</p>

		</aside>

		<!-- viikko 1 loppuu ja viikko 2 alkaa -->

		<header>
		  <h1 id="viikko2">Viikko 2</h1>
		</header>


		<h2>Erilaiset yhteystyypit</h2>

		<p>Huomaamme, että käsite Kurssisuoritus oikeastaan liittyy kahteen eri asiaan; kurssiin ja kurssin suoritukseen. Eriytetään nämä kaksi käsitettä toisistaan.</p>

		<p>Kurssiin liittyy kurssin yleiset tiedot kuten kurssin nimi, kurssikoodi, sekä kurssin kuvaus. Kurssisuoritus taas liittyy tiettyyn kurssiin, opikelijaan, päivämäärään, arvosanaan, sekä opintopistemäärään. Opintopistemäärä pidetään osana kurssisuoritusta, sillä joillain kursseilla opintopistemäärä vaihtelee työmäärästä riippuen. Käsite Opiskelija säilyy sellaisenaan.</p>

		<p>Yhteen kurssisuoritukseen liittyy aina yksi kurssi, mutta yhteen kurssiin voi liittyä monta kurssisuoritusta. Luokkakaaviona tämä näyttää seuraavalta:</p>

		<figure>
		  <img src="img/johdanto/opiskelija-kurssisuoritus-kurssi.png" alt="Opiskelija 1-* Kurssisuoritus *-1 Kurssi"/> 
		  <figcaption>Jokaisella opiskelijalla voi olla useita kurssisuorituksia, ja jokaiseen kurssisuoritukseen liittyy tasan yksi opiskelija. Jokaiseen kurssisuoritukseen liittyy myös tasan yksi kurssi, ja jokaisella kurssilla voi olla useita kurssisuorituksia.</figcaption>
		</figure>

		<p>Tutkitaan ensin ylläolevan kaavion osaa, missä kurssisuoritukseen liittyy yksi kurssi ja yhteen Kurssiin monta kurssisuoritusta. Emme hetkeen välitä Opiskelija-käsitteen olemassaolosta. Sekä kurssisuoritukselle että kurssille on määritelty niihin liittyvät attribuutit.</p>


		<figure>
		  <img src="img/johdanto/kurssisuoritus-kurssi-attrs.png" alt="[Kurssisuoritus|päivämäärä;arvosana;opintopistemäärä]*-1[Kurssi|nimi;kuvaus]"/> 
		  <figcaption>Jokaiseen kurssisuoritukseen liittyy yksi kurssi, mutta kurssilla voi olla useampia kurssisuorituksia.</figcaption>
		</figure>

		


		<aside class="info">
		  <br/>
		  <h1>Yhteystyyppi yhden suhde moneen</h1>

		  <p>Kahden käsitteen välillä on yhden suhde moneen (<code>1-N</code>) -yhteys, jos ensimmäisen käsitteen ilmentymään voi liittyä monta toisen käsitteen ilmentymää, mutta yhteen toisen käsitteen ilmentymään voi liittyä vain yksi ensimmäisen käsitteen ilmentymä.</p>

		  <p>Esimerkiksi <em>Olli Opiskelijaan</em> voi liittyä monta erilaista kurssisuoritusta, mutta tiettyyn kurssisuoritukseen voi liittyä aina vain yksi opiskelija, joka jossain tapauksessa <em>voi</em> olla Olli Opiskelija.</p>

		  <p>Saman yhteystyypin voi ajatella myös tietokantataulujen välillä. Kahden taulun välillä on yhteys yhden suhde moneen, jos yhteen ensimmäisen taulun riviin voi liittyä useita toisen taulun rivejä, mutta yhteen toisen taulun riviin voi liittyä vain yksi ensimmäisen taulun rivi.</p>

		  <p><em>Tietokantataulujen luominen</em></p>
		  
		  <figure>
		    <img src="img/viikko2/yhdesta-moneen-kasitteet.png" alt="[A]1-*[B]"/> 
		    <figcaption>Yhden suhde moneen. Yhteen A-käsitteeseen voi liittyä monta B-käsitettä, mutta yhteen B-käsitteeseen liittyy aina tasan yksi A-käsite.</figcaption>
		  </figure>
		  
		  
		  <p>Kun kahden käsitteen välillä on yhden suhde moneen -yhteys, luodaan niiden perusteella tietokantataulut seuraavasti. Luodaan ensin käsitteestä, jonka "viivan päässä" on numero 1, tietokantataulu, ja määritellään sille käsitteen ilmentymät yksilöivä pääavain. Jos käsitteeseen liittyy muita ominaisuuksia tai attribuutteja, asetetaan ne tietokantataulun sarakkeiksi.</p>
		  
		  <figure>
		    <img src="img/viikko2/kasite-a-paaavain.png" alt="[A|(pk) id]"/> 
		    <figcaption>Käsitteen A perusteella luotu tietokantataulu, jolle on määritelty pääavain <em>id</em>. </figcaption>
		  </figure>
		  
		  <p>Tämän jälkeen luodaan käsitteestä, jonka "viivan päässä" on tähti, tietokantataulu, ja määritellään sille <em>viiteavain</em>, jonka avulla voimme viitata aiemmin luotuun tauluun.</p>
		  
		  <figure>
		    <img src="img/viikko2/kasite-b-viiteavain.png" alt="[B|(fk) a_id: A]"/> 
		    <figcaption>Käsitteen B perusteella luotu tietokantataulu, jolle on määritelty viiteavain <em>a_id</em>, joka viittaa tauluun A. </figcaption>
		  </figure>
		  
		  
		  <p>Tämän jälkeen piirretään viiva tietokantataulujen välille.</p>
		  
		  
		  <figure>
		    <img src="img/viikko2/taulut-a-b.png" alt="[A|(pk) id]1-*[B|(fk) a_id: A]"/> 
		    <figcaption>Tietokantataulussa A on pääavain <em>id</em>. Tietokantataulussa B on viiteavain <code>a_id</code>, joka viittaa tietokantatauluun A.</figcaption>
		  </figure>
		  
		  <p>Yllä kuvattiin, miten yhden suhde moneen -yhteystyypin tapauksessa luodaan luokkakaaviosta tietokantataulut.</p>
		  
		</aside>
		

		<p>Luodaan seuraavaksi Kurssisuorituksesta ja Kurssista tietokantataulut.</p>


		<figure>
		  <img src="img/johdanto/kurssisuoritus-kurssi-attrs.png" alt="[Kurssisuoritus|päivämäärä;arvosana;opintopistemäärä]*-1[Kurssi|nimi;kuvaus]"/> 
		  <figcaption>Jokaiseen kurssisuoritukseen liittyy yksi kurssi, mutta kurssilla voi olla useampia kurssisuorituksia.</figcaption>
		</figure>


		<p>Ensimmäinen askel on tietokantataulun Kurssi luominen sekä sen pääavaimen määrittely. Kurssin nimi ei ole hyvä avain, sillä esimerkiksi kurssi "Tietokone työvälineenä" toistuu eri tiedekunnissa ja laitoksissa. Toisaalta, avaimen on hyvä olla sellainen, että se ei muutu -- (jos avain muuttuisi, kaikki viiteavaimet tulisi myös päivittää) -- kuvauskaan ei ole hyvä avain. Luodaan avainta varten uusi attribuutti, <em>kurssitunnus</em>, ja lisätään se tauluun muiden kurssikäsitteeseen liittyvien attribuuttien kanssa.</p>


		<figure>
		  <img src="img/viikko2/kurssi-paaavaimella.png" alt="[Kurssi|(pk) kurssitunnus;nimi;kuvaus]"/> 
		</figure>

		<p>Luodaan tämän jälkeen taulu Kurssisuoritus. Koska jokaiseen kurssisuoritukseen liittyy yksi kurssi, luodaan tauluun viiteavain <em>kurssi</em>, joka viittaa Kurssi-tauluun. Muut attribuutit lisätään tauluun viiteavaimen lisäksi.</p>


		<figure>
		  <img src="img/viikko2/kurssisuoritus-viiteavaimella.png" alt="[Kurssi|(pk) kurssitunnus;nimi;kuvaus]"/> 
		</figure>

		<p>Yhdistetään tietokantataulut vielä viivalla.</p>


		<figure>
		  <img src="img/viikko2/kurssisuoritus-ja-kurssi-tietokantataulut.png" alt="[Kurssisuoritus|(fk) kurssi: Kurssi;päivämäärä;arvosana;opintopistemäärä]*-1[Kurssi|(pk) kurssitunnus;nimi;kuvaus]"/> 
		</figure>		

		<p>&nbsp;</p>

		<p><em><strong>Kolmannen tietokantakaulun lisääminen tietokantakaavioon</strong></em></p>

		<p>Tarkastellaan seuraavaa luokkakaaviota, ja tehdään siitä seuraavaksi tietokantakaavio.</p>

		<figure>
		  <img src="img/viikko2/opiskelija-kurssisuoritus-kurssi-luokkakaavio.png" alt="[Opiskelija|opiskelijanumero;nimi;syntymävuosi;pääaine] 1-* [Kurssisuoritus|päivämäärä;arvosana;opintopistemäärä]
[Kurssisuoritus] *-1 [Kurssi|nimi;kuvaus]"/> 
		</figure>		

		<p>Teimme edellä jo käsitteistä Kurssi ja Kurssisuoritus tietokantakaavion, joten voimme keskittyä nyt käsitteiden Opiskelija ja Kurssisuoritus väliseen suhteeseen.</p>


		<p>Aloitamme taas käsitteestä, jonka viivan päässä on 1, eli tässä tapauksessa opiskelijasta. Kuten aiemmin, käytämme tietokantataululle Opiskelija avaimena opiskelijanumeroa, sillä se yksilöi jokaisen opiskelijan.</p>

		<figure>
		  <img src="img/johdanto/opiskelija-ja-opiskelijanumero.png" alt="[Opiskelija|(pk) opiskelijanumero;nimi;syntymävuosi;pääaine]">
		</figure>

		<p>Keskitytään tämän jälkeen viivan toiseen päähän, eli tässä tapauksessa käsitteeseen Kurssisuoritus. Koska yhteen kurssisuoritukseen liittyy tasan yksi opiskelija, lisätään Tauluun Kurssisuoritus viiteavain <em>opiskelija</em>, joka viittaa opiskelijaan. Muuten taulu pysyy samana kuten aiemminkin.</p>

		<p>Voimme nyt yhdistää kaikki taulut yhteen, jolloin tietokantakaavio on seuraavanlainen:</p>

		<figure>
		  <img src="img/viikko2/opiskelija-kurssisuoritus-kurssi-tietokantakaavio.png" alt="[Opiskelija|(pk) opiskelijanumero;nimi;syntymävuosi;pääaine]1-*[Kurssisuoritus|(fk) opiskelija: Opiskelija;(fk) kurssi: Kurssi;päivämäärä;arvosana;opintopistemäärä]
[Kurssisuoritus]*-1[Kurssi|(pk) kurssitunnus;nimi;kuvaus]"/> 
		</figure>

		
		
		<aside class="info">
		  <br/>
		  <h1>Yhdistelyharjoittelua SQL:llä</h1>

		  <p>Käytössämme on nyt edellä luodut tietokantataulut sekä muutamia muita tauluja, mitä luomme kohta. Harjoitellaan tässä välissä hieman kyselyiden tekemistä edellä luotuihin kolmeen tauluun.</p>

		  <p>Useamman taulun yhdistäminen tapahtuu <code>WHERE</code>-ehdon avulla esimerkiksi seuraavasti: <code>SELECT * FROM Opiskelija, Kurssisuoritus WHERE Opiskelija.opiskelijanumero = Kurssisuoritus.opiskelija</code>, eli "Anna kaikki riviyhdistelmät tauluista Opiskelija ja Kurssisuoritus, joissa attribuuttien opiskelijanumero ja opiskelija arvot ovat samat".</p>

		  <p>Edellä ehto <code>WHERE Opiskelija.opiskelijanumero = Kurssisuoritus.opiskelija</code> luo ehdon, missä kyselyn tulokseen valitaan mukaan vain ne rivit, missä Opiskelija-taulun opiskelijanumero on sama kuin Kurssisuoritus-taulun opiskelija. Käytännössä tämä kysely kytkee Opiskelija-taulun pääavaimen ja Kurssisuoritustaulun Opiskelija-tauluun viittaavan viiteavaimen.</p>

		  <div ng-controller="weekTwoSqlController">
		    <query
		       db="db"
		       query="SELECT * FROM Opiskelija, Kurssisuoritus WHERE Opiskelija.opiskelijanumero = Kurssisuoritus.opiskelija"
		       editable="false"
		       done="listOpiskelijatAndKurssisuoritukset">
		    </query>
		    
		    <div ng-show="listOpiskelijatAndKurssisuoritukset">
		      
		      <h4>Tehtävät</h4>
		      
		      <p>Tee nyt kysely, jolla saat listattua kaikki Kurssit ja niihin liittyvät kurssisuoritukset. Valitse näytettäviksi sarakkeiksi vain kurssin <code>nimi</code> ja kurssisuorituksen <code>päivämäärä</code> ja <code>arvosana</code>.</p>

		      <p>Kyselyn tuloksessa pitäisi olla 4 riviä ja 3 saraketta.</p>
		      
		      <togglable content="taulut">
			<table-info></table-info>
		      </togglable>
		      
		      <query db="db"></query>
		    </div>
		  </div>

		</aside>
		



		<p><strong><em>Yhteystyypit jatkuu: kursseihin liittyy tehtäviä</em></strong></p>
		

		<p>Haluamme, että järjestelmämme voi pitää kirjaa myös kursseihin liittyvistä tehtävistä, joita opiskelija voi suorittaa. Koska kurssiin liittyvien tehtävien määrä voi vaihdella, määritellään yhteys siten, että yhteen kurssiin voi liittyä useita tehtäviä. Toisaalta, koska sama tehtävä voi esiintyä useammalla kurssilla, määritellään yhteys siten, että yhteen tehtävään liittyä useampi kurssi.</p>


		<figure>
		  <img src="img/johdanto/tehtava-kurssi.png" alt="[Tehtävä] *-* [Kurssi]"/> 
		  <figcaption>Tehtävä voi liittyä useampaan kurssiin, ja kurssi voi liittyä useampaan tehtävään.</figcaption>
		</figure>

		<p>Yllä kuvattu yhteystyyppi on <em>monen suhde moneen</em>.</p>


		<aside class="info">
		  <br/>
		  <h1>Yhteystyyppi monen suhden moneen</h1>

		  <p>Kahden käsitteen välillä on monen suhde moneen (<code>N-N</code>) -yhteys, jos ensimmäisen käsitteen ilmentymään voi liittyä monta toisen käsitteen ilmentymää, ja toisen käsitteen ilmentymään voi liittyä monta ensimmäisen käsitteen ilmentymä.</p>

		  <p>Esimerkiksi yhteen kurssiin voi liittyä monta tehtävää, ja yksi tehtävä voi liittyä useampaan kurssiin.</p>

		  <p>Saman yhteystyypin voi ajatella myös tietokantataulujen välillä. Kahden taulun välillä on yhteys monen suhde moneen, jos yhteen ensimmäisen taulun riviin voi liittyä useita toisen taulun rivejä, ja yhteen toisen taulun riviin voi liittyä useita ensimmäisen taulun rivejä.</p>
		  

		  <p><em>Tietokantataulujen luominen</em></p>

		  <figure>
		    <img src="img/viikko2/monesta-moneen-a-b.png" alt="[A]*-*[B]"/> 
		    <figcaption>Monen suhde moneen. Yhteen A-käsitteeseen voi liittyä monta B-käsitettä, ja yhteen B-käsitteeseen voi liittyä monta A-käsitettä.</figcaption>
		  </figure>


		  <p>Jos käsitteiden välillä on monen suhde moneen -yhteys, luodaan niistä tietokantataulut seuraavasti. Määritellään ensin kummallekin käsitteelle <em>pääavain</em>.

		  <figure>
		    <img src="img/viikko2/monesta-moneen-a-b-paaavaimilla.png" alt="[A|(pk) id]
[B|(pk) id]"/> 
		    <figcaption>Tietokantataulut A ja B. Kummallekin tietokantataululle on määritelty oma taulussa olevan tiedon yksilöivä avain.</figcaption>
		  </figure>
		 
		  <p>Kun tietokantatauluille on määritelty pääavaimet, luodaan uusi tietokantataulu, jonka jokainen rivi yhdistää yhden rivin taulusta A yhden taulun B rivin kanssa. Tällaista taulua kutsutaan nimellä <em>liitostaulu</em>, ja se sisältää kaksi viiteavainta: yhden kumpaankin viitattavaan tauluun.</p>

		  <figure>
		    <img src="img/viikko2/monesta-moneen-liitostaulu.png" alt="[Liitostaulu|(fk) a_id: A;(fk) b_id: B]"/> 
		    <figcaption>Liitostaulu sisältää kaksi viiteavainta. Yhden, joka viittaa tauluun A, ja toisen, joka viittaa tauluun B.</figcaption>
		  </figure>

		  <p>Yhdistetään seuraavaksi taulut liitostaululla. Liitostaulun jokainen rivi voi viitata vain yhteen taulun A riviin ja yhteen taulun B riviin, joten liitostaulusta lähtevässä yhteydessä taulujen A ja B päätyihin tulee numerot yksi. Toisaalta, liitostaulussa voi olla monta riviä, missä esiintyy viite tiettyyn taulun A riviin -- samoin myös taulun B riviin, joten liitostaulun päähän tulee tähti.</p>



		  <figure>
		    <img src="img/viikko2/monesta-moneen-liitostaulu-yhteydet.png" alt="[A|(pk) id]1-*[Liitostaulu|(fk) a_id: A;(fk) b_id: B]
[Liitostaulu]*-1[B|(pk) id]"/> 
		    <figcaption>Liitostaulun avulla monesta moneen suhde saadaan muutettua kahdeksi yhdestä moneen suhteeksi.</figcaption>
		  </figure>

		</aside>
		
		<p>Tarkastellaan uudestaan käsitteiden tehtävä ja kurssi yhteyttä, ja muunnetaan luokkakaavio tietokantakaavioksi.</p> 

		<figure>
		  <img src="img/johdanto/tehtava-kurssi.png" alt="[Tehtävä] *-* [Kurssi]"/> 
		</figure>


		<p>Ensimmäinen askel on taulujen luominen sekä niihin liittyvien avainten määrittely. Olemme aiemmin luoneet taulun käsitteestä kurssi, sekä määritelleet sille pääavaimen, joten keskitymme vain taulun Tehtävä luomiseen.</p>

		<p>Määritellään, että tehtävään liittyy <em>nimi</em> ja <em>kuvaus</em>. Kumpikaan niistä ei sovellu tehtävän avaimeksi, joten luodaan tehtävälle avain <em>tunnus</em>, joka yksilöi jokaisen tehtävän. Käsitteestä Tehtävä luotu tietokantataulu on seuraavanlainen:</p>

		<figure>
		  <img src="img/viikko2/tehtava-tietokantataulu.png" alt="[Tehtävä|(pk) tunnus;nimi;kuvaus]"/> 
		  <figcaption>Tehtävä-taulussa on pääavaimena tunnus, jonka lisäksi sillä on attribuutit nimi ja kuvaus.</figcaption>
		</figure>


		<p>Luodaan seuraavaksi liitostaulu, jonka tehtävänä on yhdistää taulut Tehtävä ja Kurssi. Kutsutaan liitostaulua nimellä Kurssitehtävä. Kurssitehtävä-taululla on kaksi viiteavainta, joista toinen osoittaa tauluun Tehtävä, ja toinen tauluun Kurssi.</p>

		<figure>
		  <img src="img/viikko2/kurssitehtava-liitostaulu.png" alt="[Kurssitehtävä|(fk) tehtävä: Tehtävä; (fk) kurssi: Kurssi]"/> 
		  <figcaption>Kurssitehtävä-liitostaulussa on kaksi viiteavainta, jotka osoittavat tauluihin Tehtävä ja Kurssi.</figcaption>
		</figure>

		<p>Lisätään seuraavaksi yhteydet käsitteiden välille -- tämä tapahtuu lähinnä visualisoinnin takia, viitteet ovat todellisuudessa olemassa jo viiteavainten muodossa. Yhteen Kurssitehtävä-taulun riviin liittyy tasan yksi Kurssi-taulun rivi ja Tehtävä-taulun rivi, mutta yksi Kurssi-taulun rivi voi liittyä moneen Kurssitehtävä-taulun riviin -- samoin kuin yksi Tehtävä-taulun rivi voi liittyä moneen Kurssitehtävä-taulun riviin.</p>

		<p>Tietokantakaavio on lopulta seuraavanlainen:</p>

		<figure>
		  <img src="img/viikko2/monesta-moneen-tehtava-kurssitehtava-kurssi.png" alt="[Tehtävä|(pk) tunnus;nimi;kuvaus]1-*[Kurssitehtävä|(fk) tehtävä: Tehtävä; (fk) kurssi: Kurssi]
[Kurssitehtävä]*-1[Kurssi|(pk) kurssitunnus;nimi;kuvaus]"/> 
		  <figcaption>Nyt jos tehtävä on tietyllä kurssilla, on taulussa kurssitehtävä rivi, missä on tehtävän ja kurssin yksilöivä tunnus.</figcaption>
		</figure>


		<aside class="info">
		  <br/>
		  <h1>Yhteystyyppi yhden suhde yhteen</h1>

		  <p>Yhteystyyppien yhden suhde moneen ja monen suhde moneen lisäksi on myös yhteystyyppi yhden suhde yhteen. Kahden käsitteen välillä on yhden suhde yhteen (<code>1-1</code>) -yhteys, jos ensimmäisen käsitteen ilmentymään voi liittyä vain yksi toisen käsitteen ilmentymä, ja toisen käsitteen ilmentymään voi liittyä vain yksi ensimmäisen käsitteen ilmentymä.</p>

		  <p>Esimerkiksi yhdellä opiskelijalla voi olla vain yksi laite lainassa ylläpidolta, ja ylläpito voi lainata tietyn laitteen vain yhdelle opiskelijalle.</p>

		  <p>Tämänkin yhteystyypin voi ajatella myös tietokantataulujen välillä. Kahden taulun välillä on yhteys yhden suhde yhteen, jos yhteen ensimmäisen taulun riviin voi liittyä vain yksi toisen taulun rivi, ja yhteen toisen taulun riviin voi liittyä vain yksi ensimmäisen taulun rivi.</p>

		  <p><em>Tietokantataulujen luominen</em></p>

		  <figure>
		    <img src="img/viikko2/yhden-suhde-yhteen-a-b.png" alt="[A]1-1[B]"/> 
		    <figcaption>Yhden suhde yhteen. Yhteen A-käsitteeseen voi liittyä vain yksi B-käsite, ja yhteen B-käsitteeseen voi liittyä vain yksi A-käsite.</figcaption>
		  </figure>


		  <p>Jos käsitteiden välillä on yhden suhde yhteen -yhteys, tyypillisin tapa tietokantataulujen luomiseen on se, että yhdelle käsitteistä määritellään pääavain, ja toiselle viiteavain, jolla viitataan toiseen käsitteeseen.</p>



		  <figure>
		    <img src="img/viikko2/yhden-suhde-yhteen-viitteet.png" alt="[A|(pk) id]1-*[B|(fk) a_id: A]"/> 
		    <figcaption>Yhden suhde yhteen tietokantakaaviona. Käsitteestä B viitataan käsitteeseen A. </figcaption>
		  </figure>

		  <p>Kun pohdimme ylläolevaa tarkemmin, huomaamme, että yllä suoritettiin käytännössä samat askeleet kuin yhden suhde moneen -tapauksessa. Tämä on täysin totta -- käytännössä tietokantaan tulee määritellä viittaavan taulun määrittelyn yhteydessä lisäksi <em>uniikkiusrajoite</em> viiteavaimelle. Palaamme erilaisiin rajoitteisiin myöhemmin kurssilla.</p>

		</aside>


		<h2>Useammassa taulussa olevan tiedon yhdistäminen</h2>


		<p>Hahmottelimme edellisessä luvussa opiskelun ja oppimisen seuraamiseen tarkoitetun järjestelmämme tietokantaa. Päädyimme yhteystyyppien käsittelyssä kahteen tietokantakaavioon, jotka ovat seuraavat:</p>


		<figure>
		  <img src="img/viikko2/opiskelija-kurssisuoritus-kurssi-tietokantakaavio.png" alt="[Opiskelija|(pk) opiskelijanumero;nimi;syntymävuosi;pääaine]1-*[Kurssisuoritus|(fk) opiskelija: Opiskelija;(fk) kurssi: Kurssi;päivämäärä;arvosana;opintopistemäärä]
[Kurssisuoritus]*-1[Kurssi|(pk) kurssitunnus;nimi;kuvaus]"/> 
		</figure>


		<figure>
		  <img src="img/viikko2/monesta-moneen-tehtava-kurssitehtava-kurssi.png" alt="[Tehtävä|(pk) tunnus;nimi;kuvaus]1-*[Kurssitehtävä|(fk) tehtävä: Tehtävä; (fk) kurssi: Kurssi]
[Kurssitehtävä]*-1[Kurssi|(pk) kurssitunnus;nimi;kuvaus]"/> 
		</figure>


		<p>Voimme yhdistää tietokantakaaviot suoraan, sillä kumpikin kaavio sisältää taulun Kurssi. Tietokantakaavio, missä kaikki taulut ovat yhdessä, näyttää seuraavalta:</p>


		<figure>
		  <img src="img/viikko2/tietokantakaavio.png" alt="[Opiskelija|(pk) opiskelijanumero;nimi;syntymävuosi;pääaine]1-*[Kurssisuoritus|(fk) opiskelija: Opiskelija;(fk) kurssi: Kurssi;päivämäärä;arvosana;opintopistemäärä]
[Kurssisuoritus]*-1[Kurssi|(pk) kurssitunnus;nimi;kuvaus]
[Tehtävä|(pk) tunnus;nimi;kuvaus]1-*[Kurssitehtävä|(fk) tehtävä: Tehtävä; (fk) kurssi: Kurssi]
[Kurssitehtävä]*-1[Kurssi|(pk) kurssitunnus;nimi;kuvaus]"/> 

		</figure>

		<p>Voit tutkia uudessa esimerkkitietokannassa olevaa tietoa allaolevan SQL-komentotulkin avulla.</p>

		
		<div ng-controller="weekTwoSqlController">
		  
		    <togglable content="taulut">
                      <table-info></table-info>
		    </togglable>
		    
		    <query db="db"></query>		    
		</div>



		<p>Tutustuimme aiemmin SQL-kyselyihin, joiden avulla teimme erilaisia kyselyitä yksittäisiin tietokantatauluihin. Tutustutaan seuraavaksi erääseen tapaan useammassa taulussa olevan tiedon yhdistämiseen.</p>

		<p>Aiempaa materiaalia kertaamalla muistamme, että avainsanaa <code>FROM</code> seuraa taulu, josta tietoa haetaan. Voimme määritellä haun kohteeksi useampia tauluja listaamalla ne FROM-avainsanan jälkeen pilkulla eroteltuna seuraavasti <code>SELECT * FROM Opiskelija, Kurssisuoritus</code>. Jos emme kerro miten taulujen rivit yhdistetään, on lopputuloksessa kaikki rivit yhdistettynä kaikkiin riveihin -- esimerkiksi jokainen taulun Opiskelija rivi yhdistettynä jokaiseen taulun Kurssisuoritus riviin.</p>


		<div ng-controller="weekTwoSqlController">
		  <query
		     db="db"
		     query="SELECT * FROM Opiskelija, Kurssisuoritus"
		     editable="false">
		  </query>
		</div>

		<p>Yllä esitetyn kyselyn tuottama lopputulos ei ole tyypillisesti tavoiteltu -- jokaiseen opiskelijaan on kytketty jokainen kurssisuoritus, eli kaikilla on kaikki kurssisuoritukset.</p>

		<p>Taulujen yhdistäminen tapahtuu kyselyä rajaavan <code>WHERE</code>-ehdon avulla siten, että taulun pääavainta verrataan siihen viittaavan taulun viiteavaimeen. Esimerkiksi, jos haluamme vain kurssisuoritukset ja niihin liittyvät opiskelijat, hyödynnämme Opiskelija-taulun avainta opiskelijanumero sekä Kurssisuoritus-taulun viiteavainta opiskelija, joka viittaa Opiskelija-taulun pääavaimeen. Käytännössä tämä tapahtuu ehdolla <code>WHERE Opiskelija.opiskelijanumero = Kurssisuoritus.opiskelija</code>.</p>
		
		<p>Kokonaisuudessaan lause "Anna kaikki riviyhdistelmät tauluista Opiskelija ja Kurssisuoritus, joissa attribuuttien opiskelijanumero ja opiskelija arvot ovat samat" kirjoitetaan seuraavasti: <code>SELECT * FROM Opiskelija, Kurssisuoritus WHERE Opiskelija.opiskelijanumero = Kurssisuoritus.opiskelija</code>.</p>
		
		<div ng-controller="weekTwoSqlController">
		  
		  <query
		     db="db"
		     query="SELECT * FROM Opiskelija, Kurssisuoritus WHERE Opiskelija.opiskelijanumero = Kurssisuoritus.opiskelija"
		     editable="false"
		     done="listOpiskelijatJaKurssisuoritukset">
		  </query>
		  
		  <div ng-show="listOpiskelijatJaKurssisuoritukset">
		    
		    <h4>Tehtävät</h4>
		    
		    <p>Tee nyt kysely, joka tulostaa jokaisen opiskelijan nimen, kurssisuorituksen päivämäärän, ja kurssisuorituksen arvosanan.</p>
		    
		    
		    <togglable content="taulut">
                      <table-info></table-info>
		    </togglable>
		    
		    <query db="db"></query>
		  </div>
		</div>


		<p><strong><em>Useamman taulun yhdistäminen</em></strong></p>

		<p>Useamman taulun yhdistäminen onnistuu samalla tavalla. Kaikki taulut, jotka haluamme lisätä kyselyyn, tulevat FROM-avainsanan jälkeen. Jos tauluja on useampi, on hyvä varmistaa, että kaikki taulut yhdistetään avainkenttien perusteella, sillä muuten haun vastaus voi olla iso.</p>

		<p>Kun yhdistämme useampia tauluja, päädymme helposti tilanteeseen, missä tuloksessa on myös useampia samannimisiä kenttiä. Esimerkiksi omassa tietokantamäärittelyssämme kenttä nimi löytyy tauluista Tehtävä, Kurssi ja Opiskelija. Voimme määritellä taulun, mihin haettava kenttä liittyy, pisteoperaattorin avulla. Kyselyn <code>SELECT nimi FROM Opiskelija</code> voi siis kirjoittaa myös muodossa <code>SELECT Opiskelija.nimi FROM Opiskelija</code>.</p>

		<p>Voimme toisaalta myös nimetä kentän tulostusmuodon seuraavasti <code>SELECT Opiskelija.nimi AS opiskelija FROM Opiskelija</code>. Edelläoleva kysely hakee Opiskelija-taulusta opiskelijan nimen, mutta tulostaa nimet otsikolla 'opiskelija'. </p>

		<p>Allaoleva kysely listaa jokaiselta opiskelijalta opiskelijan nimen sekä opiskelijan suorittamat kurssit.</p>

		<div ng-controller="weekTwoSqlController">
		  
		  <query
		     db="db"
		     query="SELECT Opiskelija.nimi AS opiskelija, Kurssi.nimi AS kurssi 
    FROM Opiskelija, Kurssisuoritus, Kurssi 
    WHERE Opiskelija.opiskelijanumero = Kurssisuoritus.opiskelija 
        AND Kurssisuoritus.kurssi = Kurssi.kurssitunnus"
		     editable="false"
		     done="listOpiskelijanSuorittamatKurssit">
		  </query>
		  
		  <div ng-show="listOpiskelijanSuorittamatKurssit">
		    
		    <h4>Tehtävät</h4>
		    
		    <p>Tee nyt kysely, joka tulostaa jokaiseen kurssiin liittyvän tehtävän. Tulostuksen otsikoiden nimien tulee olla 'kurssi' ja 'tehtävä'.</p>
		    
		    
		    <togglable content="taulut">
                      <table-info></table-info>
		    </togglable>
		    
		    <query db="db"></query>
		  </div>
		</div>


		<aside class="info">

		  <br/>
		  <h1>Taulujen yhdistämisestä</h1>

		  <p>Yksi tapa taulujen yhdistämiseen tarvittujen kyselyjen hahmottamiseen on tietokantakaavion katsominen. Jos tavoitteena olisi esimerkiksi etsiä kaikki tehtävät, mitä Joni-niminen opiskelija on saattanut tehdä, ensimmäinen askel on etsiä polku taulusta <code>Tehtävä</code> tauluun <code>Opiskelija</code>.</p>

		  <p>Aloitamme siis taulusta <code>Tehtävä</code>, ja etsimme polun tauluun <code>Opiskelija</code>. Jotta pääsemme taulusta Tehtävä tauluun Opiskelija, tulee meidän vierailla tauluissa <code>Kurssitehtävä</code>, <code>Kurssi</code> ja <code>Kurssisuoritus</code>, jota seuraa taulu <code>Opiskelija</code>.</p>
		  <p>Kyselyä muodostaessa on hyvä yhdistää taulu kerrallaan toisiinsa.</p>

		  <ol>
		    <li>Yhdistämme ensin taulut Tehtävä ja Kurssitehtävä:
		      <pre class="sh_sql">
SELECT Tehtävä.nimi AS tehtävä 
    FROM Tehtävä, Kurssitehtävä 
    WHERE Tehtävä.tunnus = Kurssitehtava.tehtävä</pre></li>
		    
		    <li>Yhdistämme seuraavaksi edellisiin tauluihin taulun Kurssi:
		      <pre class="sh_sql">
SELECT Tehtävä.nimi AS tehtävä 
    FROM Tehtävä, Kurssitehtävä, Kurssi 
    WHERE Tehtävä.tunnus = Kurssitehtävä.tehtävä
        AND Kurssitehtävä.kurssi = Kurssi.kurssitunnus</pre></li>

		    <li>Seuraavaksi, yhdistämme kurssin kurssisuoritukseen:
		      <pre class="sh_sql">
SELECT Tehtävä.nimi as tehtävä 
    FROM Tehtävä, Kurssitehtävä, Kurssi, Kurssisuoritus
    WHERE Tehtävä.tunnus = Kurssitehtävä.tehtävä
        AND Kurssitehtävä.kurssi = Kurssi.kurssitunnus
        AND Kurssi.kurssitunnus = Kurssisuoritus.kurssi</pre></li>

		    <li>Ja viimeinkin, saamme yhdistettyä polun opiskelijaan:
		      <pre class="sh_sql">
SELECT Tehtävä.nimi AS tehtävä 
    FROM Tehtävä, Kurssitehtävä, Kurssi, Kurssisuoritus, Opiskelija
    WHERE Tehtävä.tunnus = Kurssitehtävä.tehtävä
        AND Kurssitehtävä.kurssi = Kurssi.kurssitunnus
        AND Kurssi.kurssitunnus = Kurssisuoritus.kurssi
        AND Kurssisuoritus.opiskelija = Opiskelija.opiskelijanumero</pre></li>

		    <li>Koska halusimme saada Joniin mahdollisesti liittyvät tehtävät, lisätään haettaviin kenttiin vielä opiskelijan nimi:
		      <pre class="sh_sql">
SELECT Tehtävä.nimi AS tehtävä
    FROM Tehtävä, Kurssitehtävä, Kurssi, Kurssisuoritus, Opiskelija
    WHERE Tehtävä.tunnus = Kurssitehtävä.tehtävä
        AND Kurssitehtävä.kurssi = Kurssi.kurssitunnus
        AND Kurssi.kurssitunnus = Kurssisuoritus.kurssi
        AND Kurssisuoritus.opiskelija = Opiskelija.opiskelijanumero
        AND Opiskelija.nimi = 'Joni'</pre></li>

		  </ol>

		
		</aside>

		<p>Voit kokeilla juuri rakennettua kyselyä alla.</p>

		
		<div ng-controller="weekTwoSqlController">
		  
		  <query
		     db="db"
		     query="SELECT Tehtävä.nimi AS tehtävä
    FROM Tehtävä, Kurssitehtävä, Kurssi, Kurssisuoritus, Opiskelija
    WHERE Tehtävä.tunnus = Kurssitehtävä.tehtävä
        AND Kurssitehtävä.kurssi = Kurssi.kurssitunnus
        AND Kurssi.kurssitunnus = Kurssisuoritus.kurssi
        AND Kurssisuoritus.opiskelija = Opiskelija.opiskelijanumero
        AND Opiskelija.nimi = 'Joni'">
		  </query>
		</div>

<!--

		<aside class="info">
		  <br/>

		  <h1>Käsitekaaviot ja tietokantataulut</h1>

		  <p>TODO: Olemme käsitelleet samankaltaisia asioita...</p>

		  <p>termistöä</p>

		  <p>....</p>

		</aside>
-->


                <figure>
		  <img src="img/paivitysraja.jpg" alt="päivitysraja"/> 
		  <figcaption>Päivitysraja, tähän on hyvä lopettaa lukeminen.</figcaption>
		</figure>

		<h2>Tietokantakyselyiden tekeminen ohjelmallisesti</h2>
		
		<p>Vaikka edelliset esimerkit tehtiin osana kurssimateriaalia, tehdään tietokantakyselyjä usein ohjelmallisesti tai suoraan tietokannanhallintajärjestelmässä.</p>

		<p>Ensimmäisen viikon läsnä tehtävät harjoitukset liittyvät tähän teemaan -- materiaali päivittyy kurssin edetessä.</p>

		<!-- esimerkkikoodia viikon 1 tehtävistä -->
		<!-- JDBC -->





<!--
		<h2>Avaimet ja viiteavaimet</h2>



		<h2>Relaatiomallin formaali määritelmä</h2>

		


		<h1>Tietokannat ja tietokannanhallintajärjestelmät</h1>

 
johdanto
 Mitä on tieto, strukturoimaton ja strukturoitu tieto
 näkökulmat
  “normaali ihminen”
  “ohjelmistokehittäjä”
  esimerkkejä strukturoimattomasta ja strukturoidusta tiedosta
  “miten haetaan esim. kaikki hlöt, joiden syntymävuosi on bla”
  mistä näistä dokumenteista on helpoin hakea tietoa?

-->

<!--
		<p>Eräs kännykän suhteellisesti vähenevissä määrin käytetty ominaisuus on puheluiden soittaminen. Saat soitettua tavoittelemallesi henkilölle kirjoittamalla ehkä muutaman kirjaimen hänen nimestä, tai sanomalla nimen ääneen kännykälle. Voit toisaalta lähettää myös tavoittelemallesi henkilölle viestin vaikkapa WhatsAppissa, tai, halutessasi muokata kännykän yhteystietoja vaikkapa tietokoneella netin välityksellä.</p>

-->
<!--


. Kirjoitat ehkä muutaman kirjaimen hänen nimestään, tai sanot nimen ääneen, ja kännykkäsi soittaa kaverillesi. Hetken kuluttua olettekin jo tekemässä kurssitehtäviä yhdessä. "Tuo yksi mainostaulu oli ihan hauska, etsin eilen kumiankkoja googlella, ja nyt tuo taulu näytti kumiankkoihin liittyvän mainoksen" toteaa kaverisi. Itse näit kurssikirjoihin liittyvän mainoksen, ja muistat etsineesi kurssimateriaalia netistä kännykälläsi. Päätätte kumpikin hakea tietoa avainsanalla "foliohattu" ja kävelette takaisin mainostaulun luo. Foliohattuja ei kuitenkaan näy, oliko arvauksenne mainosjärjestelmästä väärä? </p>

		<p>Strukturoitu tieto tarkoittaa tietoa, jonka muoto on määritelty etukäteen tarkasti. Tietoa tallennetaan ennalta määriteltyihin kenttiin.. 

		<p></p>

		<p>osa tästä tiedosta on strukturoitua, ...</p>

		<p>näissä monessa on taustalla tietokanta...</p>

		<p>ohjelmisto muodostaa tietynlaisen näkymän datan pohjalta.</p>

		<p>

		<p>

kenttä järjes  edellisenä päivänä 

Lehtiotsikot ovat ovat tyypillisesti 

seuraa kielioppia paikasta 

  strukturoimattomalta -

hyvin momonipuolista   -- jopa tunkevat --   aistit näet ja kuulet Helsingin keskustassa kävellessäsi Kävellessäsi kadulla kohtaa 

		<p>Tietoa kerääntyy katsot  Kävellessäsi kadulla, näet mainoksia, kuunnellessasi musiikkia  Ihminen ei pääse tietoa pakoon.</p>

		<p>Tietoa ..</p>
-->

	      <!--
johdanto
 Mitä on tieto, strukturoimaton ja strukturoitu tieto
 näkökulmat
  “normaali ihminen”
  “ohjelmistokehittäjä”
  esimerkkejä strukturoimattomasta ja strukturoidusta tiedosta
  “miten haetaan esim. kaikki hlöt, joiden syntymävuosi on bla”
  mistä näistä dokumenteista on helpoin hakea tietoa?

 Tietokannat osana jokapäiväistä elämää (bussiaikataulut, uutiset, mobiililaitteet, ym)
 Tietokanta sovelluksen komponenttina (sisällä)
 Sovelluskohtainen tietokanta
 Tietokannat erillisinä sovelluksina
 Useampi sovellus voi käyttää samaa tietokantaa
 Yksittäinen sovellus voi käyttää myös useampaa tietokantaa

 Tietokannat, tietokantamoottorit, tietokannanhallintajärjestelmät
 Tietokannanhallintajärjestelmä hallinnoi tietokantoja sekä tarjoaa kielen tietokannan käsittelyyn -- tähän olemassaolevia rajapintoja kuten SQL
 Yksittäinen tietokannanhallintajärjestelmä voi sisältää useamman tietokannan -- pitää huolta myös oikeuksista dataan (eri käyttäjillä pääsy erilaiseen dataan)
 Tietokannat ym Tietokantamoottorit hyviä, ei kande rakentaa omaa → käytetään olemassaolevia
 mitä tietokantamoottorit tekevät

 Tietokannan käyttö, kyselyt -- yhden taulun SELECT

 Konkreettinen esimerkki tietokantaa käyttävästä sovelluksesta

 Opiskelupäiväkirja 
 halutaan lisätä omia opiskelutapahtumia (SQL)
 halutaan listata omat opiskelutapahtumat (SQL)

 halutaan muokata olemassaolevia opiskelutapahtumia
 halutaan poistaa opiskelutapahtumia
 halutaan tulostaa viikoittaiset yhteenvedot omista opiskelutapahtumista

		-->



            </section>
            <!-- END WEEK1 -->

            <!-- BEGIN WEEK2 -->
            <section class="weeklimit hidden" data-week-id="2">
                <header>
                    <h1 id="viikko2">Viikko 2</h1>
                </header>

		<p><em>To be announced</em></p>
            </section>
            <!-- END WEEK2 -->

            <!-- BEGIN WEEK3 -->
            <section class="weeklimit hidden" data-week-id="3">
                <header>
                    <h1 id="viikko3">Viikko 3</h1>
                </header>

		<p><em>To be announced</em></p>
	    </section>
            <!-- END WEEK3 -->

            <!-- BEGIN WEEK4 -->
            <section class="weeklimit hidden" data-week-id="4">
                <header>
                    <h1 id="viikko4">Viikko 4</h1>
                </header>
		
		<p><em>To be announced</em></p>
	    </section>
            <!-- END WEEK4 -->

            <!-- BEGIN WEEK5 -->
            <section class="weeklimit hidden" data-week-id="5">
                <header>
                    <h1 id="viikko5">Viikko 5</h1>
                </header>

		<p><em>To be announced</em></p>
	    </section>
            <!-- END WEEK5 -->

            <!-- BEGIN WEEK6 -->
            <section class="weeklimit hidden" data-week-id="6">
                <header>
                    <h1 id="viikko6">Viikko 6</h1>
                </header>

		<p><em>To be announced</em></p>
	    </section>
            <!-- END WEEK6 -->

            <!-- BEGIN WEEK7 -->
            <section class="weeklimit hidden" data-week-id="7">
                <header>
                    <h1 id="viikko7">Viikko 7</h1>
                </header>

		<p><em>To be announced</em></p>


		<!-- helppereitä: -->


		<!--
                <aside class="extra">
                    <h1>Muutama sana sovelluksen logikonfiguraatiosta</h1>

                    <p>Sovelluksen sisäisen sielunelämän näkeminen vaatii sovelluksen logikonfiguraation muuttamista. Oma konfiguraatiotiedosto <code>application.properties</code> lisätään kansioon <code>src/main/resources</code>. Tällä tiedostolla voidaan ohjata muunmuassa minkälaisia viestejä sovelluksen logeissa näytetään, sekä rajata viestien saapumista.</p>

                    <p>Allaoleva konfiguraatio määrittelee käyttöömme DEBUG-tason pyyntöjä vastaanottavalle Spring-komponentille ja asettaa Hibernate-komponentin tekemät tietokantakyselyt näkyviksi. Komento <code>logging.file=</code> ohjaa viestit konsoliin.</p>

                    <pre>
logging.level.org.springframework.web.servlet.DispatcherServlet=DEBUG
logging.level.org.hibernate.SQL=DEBUG
logging.level.org.hibernate.type=TRACE
logging.file=</pre>

                    <p>Jos haluat nähdä kaiken mitä sovelluksessa tapahtuu, aseta konfiguraatio seuraavanlaiseksi:</p>

                    <pre>
logging.level.=TRACE
logging.file=</pre>

                </aside>





                <aside class="extra">

                    <h1>Riippuvuuksien lataamisen manuaalinen käynnistäminen NetBeansissa</h1>

                    <p>Jos NetBeans-projektin kuvakkeessa on keltainen kolmio sekä lähdekoodikansioissa mahdollinen punainen pallo, saat lisätietoa ongelmasta viemällä hiiren projektin nimen päälle.</p>

                    <p>Jos ongelmana näkyy teksti "Some dependency artifacts are not in the local repository.", eli osaa riippuvuuksista ei ole ladattu paikalliselle koneelle, voit valita oikealla hiirennäppäimellä Dependencies ja "Download Declared Dependencies". Nyt NetBeans pyytää Mavenia lataamaan riippuvuudet.</p>

                    <p>Riippuvuudet ladataan käyttäjän kotihakemiston alla olevaan kansioon ".m2".</p>

                </aside>


                <h1>Webin peruskomponentit</h1>


                <aside class="pohdi">
                    <h1>Osoitteen osat</h1>

                    <p>Tutki osoitetta <a href="http://www.googlefight.com/index.php?lang=en_GB&word1=Batman&word2=Superman" target="_blank">http://www.googlefight.com/index.php?lang=en_GB&word1=Batman&word2=Superman</a>. Mitkä tai mikä ovat/on osoitteen:</p>

                    <ul>
                        <li>protokolla</li>
                        <li>isäntäkone</li>
                        <li>portti</li>
                        <li>polku</li>
                        <li>kohdedokumentti</li>
                        <li>kyselyparametrit</li>
                        <li>ankkuri</li>
                    </ul>

                    <p>Mitkä näistä puuttuvat?</p>
                </aside>


                <h2>HTTP</h2>

                <aside class="extra">
                    <p><strong>Google Dev Tools</strong></p>

                    <p>Google Chromen DevTools-apuvälineet löytää Tools-valikosta tai painamalla F12 (Linux). Apuvälineillä voi esimerkiksi tarkastella verkkoliikennettä ja lähetettyjä ja vastaanotettuja paketteja. Valitsemalla työvälineistä Network-välilehden, ja lataamalla sivun uudestaan, näet kaikki sivua varten ladattavat osat sekä kunkin osan lataamiseen kuluneen ajan.</p>

                </aside>
		
		<h2>Tehtavien nayttaminen</h2>

                <div class="tehtavat">

                    <p>Tästä eteenpäin materiaalissa on myös ohjelmointitehtäviä. Tehtävien tekeminen ja palautus tapahtuu NetBeans-ympäristössä Test My Code-liitännäisen avulla. Test My Code lataa tehtäväpohjat sinulle valmiiksi, eli et tarvitse <code>start.spring.io</code>-osoitteen projektipohjia tehtävien tekemiseen. Muistathan palauttaa jokaisen tehtävän (<em>submit solution</em>). Tehtävät avataan tehtävän otsikkoa klikkaamalla.</p>

                    <p>Huomaat, että tehtävien lisäksi TMC lataa käyttöösi myös projektin nimeltä Hiekkalaatikko. Voit käyttää sitä omiin kokeiluihin.</p>

                    <div class="tehtava" id="t-helloweb-ex">

                        <header>
                            <h1>
                                <a data-toggle="collapse" class="collapsed" href="#t-helloweb">
                                    Hello World!
                                </a>
                            </h1>
                        </header>

                        <div id="t-helloweb" class="collapse">

                            <p>Kuten huomattava osa ohjelmointikursseista, tämäkin kurssi alkaa tehtävällä, jossa toteutettava ohjelma kirjoittaa tekstin <code>Hello World!</code>.</p>

                            <p>Toteuta pakkauksessa <code>wad.controller</code> olevaan luokkaan <code>HelloWorldController</code> kontrollerimetodi, joka kuuntelee kaikkia osoitteita. Kun palvelin vastaanottaa pyynnön, tulee palvelimen palauttaa merkkijono "Hello World!".</p>

                            <p>Käynnistä palvelin painamalla NetBeansin play-nappia tai suorittamalla <code>Application</code>-luokan <code>main</code>-metodi. Avaa nettiselain, mene osoitteeseen <a href="http://localhost:8080/" target="_blank">http://localhost:8080/</a>, ja näet selaimessasi tekstin "Hello World!".</p>

                            <p><img class="browser-img" src="img/exercises/w1e01.png"/></p>

                            <p>Palvelin sammutetaan NetBeansissa punaista nappia painamalla -- vain yksi sovellus voi olla kerrallaan päällä samassa osoitteessa. Palauta tehtävä lopuksi Test My Code:n submit-napilla.</p>
                        </div>
                    </div>

                    <div class="tehtava" id="t-vieraslaskuri">

                        <header>
                            <h1>
                                <a data-toggle="collapse" class="collapsed" href="#t-vieraslaskuri">
                                    Vieraslaskuri
                                </a>
                            </h1>
                        </header>
                        <div id="t-vieraslaskuri" class="collapse">
                            <p>Vieraslaskuri kertoo kävijälle kuinka monta kävijää sivulla on käynyt tähän mennessä. Ensimmäinen kävijä näkee luvun 1, toinen kävijä luvun 2, jne.</p>

                            <p>Toteuta pakkauksessa <code>wad.controller</code> olevaan luokkaan <code>VisitCountController</code> polkua <code>/visits</code> kuunteleva metodi, joka toteuttaa toivotun toiminnallisuuden. Vinkki! Kontrolleriluokka luodaan vain kerran palvelimen käynnistyksen yhteydessä, joten voinet hyödyntää jotain sopivaa oliomuuttujaa.</p>

                            <p>Testaa sovellustasi. Ensimmäisellä pyynnöllä osoitteeseen <code>http://localhost:8080/visits</code> sinun pitäisi nähdä numero 1, toisella pyynnöllä numero 2 jne. Kun käynnistät palvelimen uudelleen, laskuri alkaa taas yhdestä.</p>
                        </div>
                    </div>
                </div>


		<p>Ja toinen tehtävä</h2>

                <div class="tehtavat">

                    <div class="tehtava">
                        <header>
                            <h1>
                                <a data-toggle="collapse" class="collapsed" href="#t-kaikupalvelu">
                                    Papukaija Bob
                                </a>
                            </h1>
                        </header>
                        <div id="t-kaikupalvelu" class="collapse">

                            <p>Papukaija <a href="https://www.youtube.com/watch?v=6NG37huf2dU" target="_blank">Bob</a> on netti-ilmiö, joka on oppinut sanoja, joita se toistaa. Tässä tehdään Bobille vastine, joka osaa toistaa sille sanottavia asioita.</p>

                            <p>Toteuta luokkaan <code>ParrotController</code> kontrollerimetodi, joka kuuntelee pyyntöjä <code>/bob</code>-osoitteessa. Jos pyynnön mukana ei ole <code>message</code>-nimistä parametria, on vastaus <code>"Krraaa"</code>. Muuten, vastaus on <code>"Krraaa"</code>, jota seuraa välilyönti ja <code>message</code>-parametrin arvo.</p>

                            <p>Kun testaat sovellusta, pyyntö osoitteeseen <code>http://localhost:8080/bob</code> näyttää sivun, jossa on merkkijono <code>"Krraaa"</code>, kun taas esimerkiksi pyyntö <code>http://localhost:8080/bob?message=keksii</code> palauttaa merkkijonon <code>"Krraaa keksii"</code>.</p>
                        </div>
                    </div>

                    <div class="tehtava">
                        <header>
                            <h1>
                                <a data-toggle="collapse" class="collapsed" href="#t-laskin">
                                    Laskin
                                </a>
                            </h1>
                        </header>
                        <div id="t-laskin" class="collapse">

                            <p>Toteuta luokkaan <code>CalculatorController</code> kontrollerimetodi, joka kuuntelee pyyntöjä <code>/calculate</code>-osoitteessa. Pyynnön mukana voi olla kolme parametria. Parametri <code>"op"</code> kertoo laskuoperaation, <code>"first"</code> kertoo ensimmäisen laskettavan luvun, ja <code>"second"</code> kertoo toisen laskettavan luvun.</p>

                            <p>Jos parametria <code>"op"</code> ei ole pyynnössä mukana, tulee sen saada oletusarvoksi <code>"plus"</code>. Jos parametri <code>"first"</code> puuttuu, saa se oletuksena arvon 0. Myös parametri <code>"second"</code> saa puuttuessaan arvon 0.</p>

                            <p>Laskimen tulee toteuttaa seuraavat operaatiot:</p>

                            <ul>
                                <li>Kun operaatio (op) on <code>"plus"</code> laskin palauttaa lukujen <code>"first"</code> ja <code>"second"</code> summan. Esim. pyyntö osoitteeseen <code>http://localhost:8080/calculate?op=plus&first=3&second=1</code> palauttaa arvon <code>4</code>.</li>
                                <li>Kun operaatio (op) on <code>"minus"</code> laskin palauttaa lukujen <code>"first"</code> ja <code>"second"</code> erotuksen. Esim. pyyntö osoitteeseen <code>http://localhost:8080/calculate?op=minus&first=7&second=2</code> palauttaa arvon <code>5</code>.</li>
                                <li>Kun operaatio (op) on <code>"multiply"</code> laskin palauttaa lukujen <code>"first"</code> ja <code>"second"</code> tulon. Esim. pyyntö osoitteeseen <code>http://localhost:8080/calculate?op=multiply&first=11&second=3</code> palauttaa arvon <code>33</code>.</li>
                            </ul>
                        </div>
                    </div>
                </div>


		<p>Moniosainen tehtävä</p>

                <div class="tehtava">
                    <header>
                        <h1>
                            <a data-toggle="collapse" class="collapsed" href="#t-tehtavalista">
                                Tehtävälista
                            </a>
                        </h1>
                    </header>
                    <div id="t-tehtavalista" class="collapse">
                        <p>Tässä tehtävässä toteutetaan tehtävälistatoiminnallisuutta. Tehtäväpohjassa on valmis tietokantakonfiguraatio, missä käytetään muistiin ladattavaa tietokantaa -- tietokanta tyhjenee palvelimen sammuessa.</p>

                        <h1>Tehtävien listaaminen</h1>

                        <p>Toteuta <code>TaskController</code>-luokkaan <code>/tasks</code>-osoitteeseen tulevia GET-tyyppisiä pyyntöjä kuunteleva kontrollerimetodi. Pyynnön tulee lisätä <code>model</code>-parametriin <code>tasks</code> kaikki tietokannasta löytyvät tehtävät. Tässä <code>taskRepository</code>-olion <code>findAll</code>-metodi on hyödyksi. Palauta käyttäjälle kansiossa <code>/WEB-INF/views</code> oleva <code>page.jsp</code>-sivu.</p>

                        <h1>Tehtävän lisääminen</h1>

                        <p>Toteuta <code>TaskController</code>-luokkaan <code>/tasks</code>-osoitteeseen tulevia POST-tyyppisiä pyyntöjä kuunteleva kontrollerimetodi. Pyynnön mukana tulee <code>name</code> ja <code>done</code>-parametrit, joiden pohjalta luodaan uusi tehtävä. Jos tehtävän nimi (<em>name</em>) ei ole tyhjä ja se ei ole null, tulee tehtävä tallentaa tietokantaan. Tässä <code>taskRepository</code>-olion <code>save</code>-metodi on hyödyksi.</p>

                        <p>Kun uusi tehtävä on lisätty, uudelleenohjaa pyyntö aiemmin toteuttamallesi tehtävät listaavalle kontrollerimetodille.</p>

                        <h1>Tehtävän poistaminen</h1>

                        <p>Toteuta <code>TaskController</code>-luokkaan <code>/tasks/{id}/delete</code>-osoitteeseen POST-tyyppisiä pyyntöjä kuunteleva kontrollerimetodi. Poistettavan tehtävän <code>id</code> on osana osoitetta. Tässä <code>taskRepository</code>-olion <code>delete</code>-metodi on hyödyksi.</p>

                        <p>Kun tehtävä on poistettu, uudelleenohjaa pyyntö aiemmin toteuttamallesi tehtävät listaavalle kontrollerimetodille.</p>

                        <h1>Tehtävän muuttaminen tehdyksi</h1>

                        <p>Toteuta <code>TaskController</code>-luokkaan <code>/tasks/{id}/done</code>-osoitteeseen POST-tyyppisiä pyyntöjä kuunteleva kontrollerimetodi. Tehtävän, joka tulee asettaa tehdyksi, <code>id</code> on osana osoitetta. Tässä <code>taskRepository</code>-olion <code>findOne</code>-metodi on hyödyksi.</p>

                        <p>Kun tehtävä on on asetettu tehdyksi, uudelleenohjaa pyyntö aiemmin toteuttamallesi tehtävät listaavalle kontrollerimetodille. Huom! Jotta tietokannasta hakemaasi olioon tehdyt muutokset päivittyvät, sinun tulee joko käyttää <code>@Transactional</code>-annotaatiota, tai tallentaa olio muutosten jälkeen.</p>
                    </div>
                </div>



-->


	    </section>
            <!-- END WEEK7 -->

        </article>

        <footer>
            <p>
                <a id="license" rel="license" href="http://creativecommons.org/licenses/by-nc-sa/2.0/"><img alt="Creative Commons License" style="border-width:0; float:left; padding:15px" src="http://i.creativecommons.org/l/by-nc-sa/2.0/88x31.png" /></a>
                <small>T&auml;m&auml; materiaali on lisensoitu Creative Commons BY-NC-SA-lisenssill&auml;, joten voit k&auml;ytt&auml;&auml; ja levitt&auml;&auml; sit&auml; vapaasti, kunhan alkuper&auml;isten tekij&ouml;iden nimi&auml; ei poisteta. Jos teet muutoksia materiaaliin ja haluat levitt&auml;&auml; muunneltua versiota, se t&auml;ytyy lisensoida samanlaisella vapaalla lisenssill&auml;. Materiaalien k&auml;ytt&ouml; kaupalliseen tarkoitukseen on ilman erillist&auml; lupaa kielletty. Tekij&auml;(t): <a href="http://www.cs.helsinki.fi/en/people/avihavai" target="_blank">Arto Vihavainen</a> ja <a href="http://www.cs.helsinki.fi/en/people/mluukkai" target="_blank">Matti Luukkainen</a> (<a href="http://www.cs.helsinki.fi/en/rage" target="_blank">Agile Education Research</a> -tutkimusryhm&auml;).
            </p>
        </footer>

        <div class="hidden">
            <p>the end.</p>
        </div>


        <script src="js/libs/jquery/jquery.js"></script>
        <script src="js/libs/jqueryui/jquery-ui.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>

        <script src="js/libs/syntaxhighlight/sh_main.min.js"></script>
        <script src="js/tikape.js"></script>



	<!-- angularjs -->
	<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.14/angular.min.js"></script>
	<!-- tikape sqljs -- https://github.com/mluukkai/tikape-sqljs -->
        <script src="js/libs/sql.js"></script>
        <script src="js/table.js"></script>
        <script src="js/app.js"></script>
        <script src="js/directives.js"></script>
    </body>
</html>
